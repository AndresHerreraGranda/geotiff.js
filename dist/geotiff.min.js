!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){var d=arguments[3],e=arguments[4],f=arguments[5],g=JSON.stringify;b.exports=function(a,b){function c(a){q[a]=!0;for(var b in e[a][1]){var d=e[a][1][b];q[d]||c(d)}}for(var h,i=Object.keys(f),j=0,k=i.length;j<k;j++){var l=i[j],m=f[l].exports;if(m===a||m&&m.default===a){h=l;break}}if(!h){h=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var n={},j=0,k=i.length;j<k;j++){var l=i[j];n[l]=l}e[h]=[Function(["require","module","exports"],"("+a+")(self)"),n]}var o=Math.floor(Math.pow(16,8)*Math.random()).toString(16),p={};p[h]=h,e[o]=[Function(["require"],"var f = require("+g(h)+");(f.default ? f.default : f)(self);"),p];var q={};c(o);var r="("+d+")({"+Object.keys(q).map(function(a){return g(a)+":["+e[a][0]+","+g(e[a][1])+"]"}).join(",")+"},{},["+g(o)+"])",s=window.URL||window.webkitURL||window.mozURL||window.msURL,t=new Blob([r],{type:"text/javascript"});if(b&&b.bare)return t;var u=s.createObjectURL(t),v=new Worker(u);return v.objectURL=u,v}},{}],2:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(){d(this,a)}return e(a,[{key:"isAsync",value:function(){return"undefined"==typeof this.decodeBlock}}]),a}();c.default=f},{}],3:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a("../abstractdecoder"),j=d(i),k=function(a){function b(){return e(this,b),f(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return g(b,a),h(b,[{key:"decodeBlock",value:function(){throw new Error("not supported")}}]),b}(j.default);c.default=k},{"../abstractdecoder":2}],4:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a){switch(a){case void 0:case 1:return new g.default;case 5:return new i.default;case 6:throw new Error("JPEG compression not supported.");case 8:return new k.default;case 32773:return new m.default;default:throw new Error("Unknown compression method identifier: "+this.fileDirectory.Compression)}}Object.defineProperty(c,"__esModule",{value:!0}),c.getDecoder=e;var f=a("./raw"),g=d(f),h=a("./lzw"),i=d(h),j=a("./deflate"),k=d(j),l=a("./packbits"),m=d(l)},{"./deflate":3,"./lzw":5,"./packbits":6,"./raw":7}],5:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function g(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a("../abstractdecoder"),j=d(i),k=9,l=12,m=256,n=257,o=function(){function a(){g(this,a),this.littleEndian=!1,this.position=0,this._makeEntryLookup=!1,this.dictionary=[]}return h(a,[{key:"initDictionary",value:function(){this.dictionary=new Array(258),this.entryLookup={},this.byteLength=k;for(var a=0;a<=257;++a)this.dictionary[a]=[a],this._makeEntryLookup&&(this.entryLookup[a]=a)}},{key:"decompress",value:function(a){this._makeEntryLookup=!1,this.initDictionary(),this.position=0,this.result=[],a.buffer||(a=new Uint8Array(a));for(var b=new DataView(a.buffer),c=this.getNext(b),d=void 0;c!==n;){if(c===m){for(this.initDictionary(),c=this.getNext(b);c===m;)c=this.getNext(b);if(c>m)throw new Error("corrupted code at scanline "+c);if(c===n)break;var e=this.dictionary[c];this.appendArray(this.result,e),d=c}else if(void 0!==this.dictionary[c]){var f=this.dictionary[c];this.appendArray(this.result,f);var g=this.dictionary[d].concat(this.dictionary[c][0]);this.addToDictionary(g),d=c}else{var h=this.dictionary[d];if(!h)throw new Error("Bogus entry. Not in dictionary, "+d+" / "+this.dictionary.length+", position: "+this.position);var i=h.concat(this.dictionary[d][0]);this.appendArray(this.result,i),this.addToDictionary(i),d=c}this.dictionary.length>=Math.pow(2,this.byteLength)-1&&this.byteLength++,c=this.getNext(b)}return new Uint8Array(this.result)}},{key:"appendArray",value:function(a,b){for(var c=0;c<b.length;++c)a.push(b[c]);return a}},{key:"haveBytesChanged",value:function(){return this.dictionary.length>=Math.pow(2,this.byteLength)&&(this.byteLength++,!0)}},{key:"addToDictionary",value:function(a){return this.dictionary.push(a),this._makeEntryLookup&&(this.entryLookup[a]=this.dictionary.length-1),this.haveBytesChanged(),this.dictionary.length-1}},{key:"getNext",value:function(a){var b=this.getByte(a,this.position,this.byteLength);return this.position+=this.byteLength,b}},{key:"getByte",value:function(a,b,c){var d=b%8,e=Math.floor(b/8),f=8-d,g=b+c-8*(e+1),h=8*(e+2)-(b+c),i=8*(e+2)-b;if(h=Math.max(0,h),e>=a.byteLength)return console.warn("ran off the end of the buffer before finding EOI_CODE (end on input code)"),n;var j=a.getUint8(e,this.littleEndian)&Math.pow(2,8-d)-1;j<<=c-f;var k=j;if(e+1<a.byteLength){var l=a.getUint8(e+1,this.littleEndian)>>>h;l<<=Math.max(0,c-i),k+=l}if(g>8&&e+2<a.byteLength){var m=8*(e+3)-(b+c),o=a.getUint8(e+2,this.littleEndian)>>>m;k+=o}return k}},{key:"compress",value:function(a){this._makeEntryLookup=!0,this.initDictionary(),this.position=0;var b=[],c=[];b=this.appendArray(b,this.binaryFromByte(m,this.byteLength));for(var d=0;d<a.length;++d){var e=[a[d]],f=c.concat(e);if(void 0!==this.entryLookup[f])c=f;else{var g=this.entryLookup[c],h=this.binaryFromByte(g,this.byteLength);b=this.appendArray(b,h),this.addToDictionary(f),c=e,this.dictionary.length>=Math.pow(2,l)&&(b=this.appendArray(b,this.binaryFromByte(m,this.byteLength)),this.initDictionary())}}var i=this.entryLookup[c],j=this.binaryFromByte(i,this.byteLength);return b=this.appendArray(b,j),b=b=this.appendArray(b,this.binaryFromByte(n,this.byteLength)),this.binary=b,this.result=this.binaryToUint8(b),this.result}},{key:"byteFromCode",value:function(a){return this.dictionary[a]}},{key:"binaryFromByte",value:function(a){for(var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,c=new Uint8Array(b),d=0;d<c.length;++d){var e=Math.pow(2,d),f=(a&e)>0;c[c.length-1-d]=f}return c}},{key:"binaryToNumber",value:function(a){for(var b=0,c=0;c<a.length;++c)b+=Math.pow(2,a.length-c-1)*a[c];return b}},{key:"inputToBinary",value:function(a){for(var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,c=new Uint8Array(a.length*b),d=0;d<a.length;++d){var e=this.binaryFromByte(a[d],b);c.set(e,d*b)}return c}},{key:"binaryToUint8",value:function(a){for(var b=new Uint8Array(Math.ceil(a.length/8)),c=0,d=0;d<a.length;d+=8){for(var e=0,f=0;f<8&&d+f<a.length;++f)e+=a[d+f]*Math.pow(2,8-f-1);b[c]=e,++c}return b}}]),a}(),p=function(a){function b(){return g(this,b),e(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return f(b,a),h(b,[{key:"decodeBlock",value:function(a){return Promise.resolve((new o).decompress(a).buffer)}}]),b}(j.default);c.default=p},{"../abstractdecoder":2}],6:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a("../abstractdecoder"),j=d(i),k=function(a){function b(){return e(this,b),f(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return g(b,a),h(b,[{key:"decodeBlock",value:function(a){for(var b=new DataView(a),c=[],d=0;d<a.byteLength;++d){var e=b.getInt8(d);if(e<0){var f=b.getUint8(d+1);e=-e;for(var g=0;g<=e;++g)c.push(f);d+=1}else{for(var h=0;h<=e;++h)c.push(b.getUint8(d+h+1));d+=e+1}}return Promise.resolve(new Uint8Array(c).buffer)}}]),b}(j.default);c.default=k},{"../abstractdecoder":2}],7:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a("../abstractdecoder"),j=d(i),k=function(a){function b(){return e(this,b),f(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return g(b,a),h(b,[{key:"decodeBlock",value:function(a){return Promise.resolve(a)}}]),b}(j.default);c.default=k},{"../abstractdecoder":2}],8:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(b){d(this,a),this._dataView=new DataView(b)}return e(a,[{key:"getUint64",value:function(a,b){var c=this.getUint32(a,b),d=this.getUint32(a+4,b);return b?c<<32|d:d<<32|c}},{key:"getInt64",value:function(a,b){var c,d;return b?(c=this.getInt32(a,b),d=this.getUint32(a+4,b),c<<32|d):(c=this.getUint32(a,b),d=this.getInt32(a+4,b),d<<32|c)}},{key:"getUint8",value:function(a,b){return this._dataView.getUint8(a,b)}},{key:"getInt8",value:function(a,b){return this._dataView.getInt8(a,b)}},{key:"getUint16",value:function(a,b){return this._dataView.getUint16(a,b)}},{key:"getInt16",value:function(a,b){return this._dataView.getInt16(a,b)}},{key:"getUint32",value:function(a,b){return this._dataView.getUint32(a,b)}},{key:"getInt32",value:function(a,b){return this._dataView.getInt32(a,b)}},{key:"getFloat32",value:function(a,b){return this._dataView.getFloat32(a,b)}},{key:"getFloat64",value:function(a,b){return this._dataView.getFloat64(a,b)}},{key:"buffer",get:function(){return this._dataView.buffer}}]),a}();c.default=f},{}],9:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a("./globals"),h=a("./geotiffimage"),i=d(h),j=a("./dataview64"),k=d(j),l=function(){function a(b){var c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e(this,a),this.dataView=new k.default(b),this.cache=c.cache||!1;var d=this.dataView.getUint16(0,0);if(18761===d)this.littleEndian=!0;else{if(19789!==d)throw new TypeError("Invalid byte order value.");this.littleEndian=!1}var f=this.dataView.getUint16(2,this.littleEndian);if(42===this.dataView.getUint16(2,this.littleEndian))this.bigTiff=!1;else{if(43!==f)throw new TypeError("Invalid magic number.");this.bigTiff=!0;var g=this.dataView.getUint16(4,this.littleEndian);if(8!==g)throw new Error("Unsupported offset byte-size.")}this.fileDirectories=this.parseFileDirectories(this.getOffset(this.bigTiff?8:4))}return f(a,[{key:"getOffset",value:function(a){return this.bigTiff?this.dataView.getUint64(a,this.littleEndian):this.dataView.getUint32(a,this.littleEndian)}},{key:"getFieldTypeLength",value:function(a){switch(a){case g.fieldTypes.BYTE:case g.fieldTypes.ASCII:case g.fieldTypes.SBYTE:case g.fieldTypes.UNDEFINED:return 1;case g.fieldTypes.SHORT:case g.fieldTypes.SSHORT:return 2;case g.fieldTypes.LONG:case g.fieldTypes.SLONG:case g.fieldTypes.FLOAT:return 4;case g.fieldTypes.RATIONAL:case g.fieldTypes.SRATIONAL:case g.fieldTypes.DOUBLE:case g.fieldTypes.LONG8:case g.fieldTypes.SLONG8:case g.fieldTypes.IFD8:return 8;default:throw new RangeError("Invalid field type: "+a)}}},{key:"getValues",value:function(a,b,c){var d=null,e=null,f=this.getFieldTypeLength(a);switch(a){case g.fieldTypes.BYTE:case g.fieldTypes.ASCII:case g.fieldTypes.UNDEFINED:d=new Uint8Array(b),e=this.dataView.getUint8;break;case g.fieldTypes.SBYTE:d=new Int8Array(b),e=this.dataView.getInt8;break;case g.fieldTypes.SHORT:d=new Uint16Array(b),e=this.dataView.getUint16;break;case g.fieldTypes.SSHORT:d=new Int16Array(b),e=this.dataView.getInt16;break;case g.fieldTypes.LONG:d=new Uint32Array(b),e=this.dataView.getUint32;break;case g.fieldTypes.SLONG:d=new Int32Array(b),e=this.dataView.getInt32;break;case g.fieldTypes.LONG8:case g.fieldTypes.IFD8:d=new Array(b),e=this.dataView.getUint64;break;case g.fieldTypes.SLONG8:d=new Array(b),e=this.dataView.getInt64;break;case g.fieldTypes.RATIONAL:d=new Uint32Array(2*b),e=this.dataView.getUint32;break;case g.fieldTypes.SRATIONAL:d=new Int32Array(2*b),e=this.dataView.getInt32;break;case g.fieldTypes.FLOAT:d=new Float32Array(b),e=this.dataView.getFloat32;break;case g.fieldTypes.DOUBLE:d=new Float64Array(b),e=this.dataView.getFloat64;break;default:throw new RangeError("Invalid field type: "+a)}if(a!==g.fieldTypes.RATIONAL&&a!==g.fieldTypes.SRATIONAL)for(var h=0;h<b;++h)d[h]=e.call(this.dataView,c+h*f,this.littleEndian);else for(var i=0;i<b;i+=2)d[i]=e.call(this.dataView,c+i*f,this.littleEndian),d[i+1]=e.call(this.dataView,c+(i*f+4),this.littleEndian);return a===g.fieldTypes.ASCII?String.fromCharCode.apply(null,d):d}},{key:"getFieldValues",value:function(a,b,c,d){var e=void 0,f=this.getFieldTypeLength(b);if(f*c<=(this.bigTiff?8:4))e=this.getValues(b,c,d);else{var h=this.getOffset(d);e=this.getValues(b,c,h)}return 1===c&&g.arrayFields.indexOf(a)===-1&&b!==g.fieldTypes.RATIONAL&&b!==g.fieldTypes.SRATIONAL?e[0]:e}},{key:"parseGeoKeyDirectory",value:function(a){var b=a.GeoKeyDirectory;if(!b)return null;for(var c={},d=4;d<4*b[3];d+=4){var e=g.geoKeyNames[b[d]],f=b[d+1]?g.fieldTagNames[b[d+1]]:null,h=b[d+2],i=b[d+3],j=null;if(f){if(j=a[f],"undefined"==typeof j||null===j)throw new Error("Could not get value of geoKey '"+e+"'.");"string"==typeof j?j=j.substring(i,i+h-1):j.subarray&&(j=j.subarray(i,i+h-1))}else j=i;c[e]=j}return c}},{key:"parseFileDirectories",value:function(a){for(var b=a,c=[];0!==b;){for(var d=this.bigTiff?this.dataView.getUint64(b,this.littleEndian):this.dataView.getUint16(b,this.littleEndian),e={},f=this.bigTiff?20:12,h=a+(this.bigTiff?8:2),i=0;i<d;h+=f,++i){var j=this.dataView.getUint16(h,this.littleEndian),k=this.dataView.getUint16(h+2,this.littleEndian),l=this.bigTiff?this.dataView.getUint64(h+4,this.littleEndian):this.dataView.getUint32(h+4,this.littleEndian);e[g.fieldTagNames[j]]=this.getFieldValues(j,k,l,h+(this.bigTiff?12:8)),b=this.getOffset(h)}c.push([e,this.parseGeoKeyDirectory(e)])}return c}},{key:"getImage",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=this.fileDirectories[a];if(!b)throw new RangeError("Invalid image index");return new i.default(b[0],b[1],this.dataView,this.littleEndian,this.cache)}},{key:"getImageCount",value:function(){return this.fileDirectories.length}}]),a}();c.default=l},{"./dataview64":8,"./geotiffimage":10,"./globals":11}],10:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b,c){for(var d=0,e=b;e<c;++e)d+=a[e];return d}function g(a,b,c){switch(a){case 1:switch(b){case 8:return new Uint8Array(c);case 16:return new Uint16Array(c);case 32:return new Uint32Array(c)}break;case 2:switch(b){case 8:return new Int8Array(c);case 16:return new Int16Array(c);case 32:return new Int32Array(c)}break;case 3:switch(b){case 32:return new Float32Array(c);case 64:return new Float64Array(c)}}throw Error("Unsupported data format/bitsPerSample")}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a("./globals"),j=a("./rgb"),k=a("./pool"),l=d(k),m=function(){function a(b,c,d,f,g){e(this,a),this.fileDirectory=b,this.geoKeys=c,this.dataView=d,this.littleEndian=f,this.tiles=g?{}:null,this.isTiled=!b.StripOffsets;var h=b.PlanarConfiguration;if(this.planarConfiguration="undefined"==typeof h?1:h,1!==this.planarConfiguration&&2!==this.planarConfiguration)throw new Error("Invalid planar configuration.")}return h(a,[{key:"getFileDirectory",value:function(){return this.fileDirectory}},{key:"getGeoKeys",value:function(){return this.geoKeys}},{key:"getWidth",value:function(){return this.fileDirectory.ImageWidth}},{key:"getHeight",value:function(){return this.fileDirectory.ImageLength}},{key:"getSamplesPerPixel",value:function(){return this.fileDirectory.SamplesPerPixel}},{key:"getTileWidth",value:function(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}},{key:"getTileHeight",value:function(){return this.isTiled?this.fileDirectory.TileLength:this.fileDirectory.RowsPerStrip}},{key:"getBytesPerPixel",value:function(){for(var a=0,b=0;b<this.fileDirectory.BitsPerSample.length;++b){var c=this.fileDirectory.BitsPerSample[b];if(c%8!==0)throw new Error("Sample bit-width of "+c+" is not supported.");if(c!==this.fileDirectory.BitsPerSample[0])throw new Error("Differing size of samples in a pixel are not supported.");a+=c}return a/8}},{key:"getSampleByteSize",value:function(a){if(a>=this.fileDirectory.BitsPerSample.length)throw new RangeError("Sample index "+a+" is out of range.");var b=this.fileDirectory.BitsPerSample[a];if(b%8!==0)throw new Error("Sample bit-width of "+b+" is not supported.");return b/8}},{key:"getReaderForSample",value:function(a){var b=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[a]:1,c=this.fileDirectory.BitsPerSample[a];switch(b){case 1:switch(c){case 8:return DataView.prototype.getUint8;case 16:return DataView.prototype.getUint16;case 32:return DataView.prototype.getUint32}break;case 2:switch(c){case 8:return DataView.prototype.getInt8;case 16:return DataView.prototype.getInt16;case 32:return DataView.prototype.getInt32}break;case 3:switch(c){case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}}throw Error("Unsupported data format/bitsPerSample")}},{key:"getArrayForSample",value:function(a,b){var c=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[a]:1,d=this.fileDirectory.BitsPerSample[a];return g(c,d,b)}},{key:"getDecoder",value:function(){return this.decoder}},{key:"getTileOrStrip",value:function(a,b,c,d){var e=Math.ceil(this.getWidth()/this.getTileWidth()),f=Math.ceil(this.getHeight()/this.getTileHeight()),g=void 0,h=this.tiles;1===this.planarConfiguration?g=b*e+a:2===this.planarConfiguration&&(g=c*e*f+b*e+a);var i=void 0,j=void 0;this.isTiled?(i=this.fileDirectory.TileOffsets[g],j=this.fileDirectory.TileByteCounts[g]):(i=this.fileDirectory.StripOffsets[g],j=this.fileDirectory.StripByteCounts[g]);var k=this.dataView.buffer.slice(i,i+j),l=void 0;return null===h?l=d.decodeBlock(k):h[g]||(h[g]=l=d.decodeBlock(k)),l.then(function(d){return{x:a,y:b,sample:c,data:d}})}},{key:"_readRaster",value:function(a,b,c,d,e){for(var g=this,h=this.getTileWidth(),i=this.getTileHeight(),j=Math.floor(a[0]/h),k=Math.ceil(a[2]/h),l=Math.floor(a[1]/i),m=Math.ceil(a[3]/i),n=a[2]-a[0],o=this.getBytesPerPixel(),p=[],q=[],r=0;r<b.length;++r)1===this.planarConfiguration?p.push(f(this.fileDirectory.BitsPerSample,0,b[r])/8):p.push(0),q.push(this.getReaderForSample(b[r]));for(var s=[],t=this.littleEndian,u=l;u<m;++u)for(var v=j;v<k;++v)for(var w=function(f){var j=f,k=b[j];2===g.planarConfiguration&&(o=g.getSampleByteSize(k));var l=g.getTileOrStrip(v,u,k,e);s.push(l),l.then(function(e){for(var f=new DataView(e.data),g=e.y*i,k=e.x*h,l=(e.y+1)*i,m=(e.x+1)*h,r=q[j],s=Math.min(i,i-(l-a[3])),u=Math.min(h,h-(m-a[2])),v=Math.max(0,a[1]-g);v<s;++v)for(var w=Math.max(0,a[0]-k);w<u;++w){var x=(v*h+w)*o,y=r.call(f,x+p[j],t),z=void 0;d?(z=(v+g-a[1])*n*b.length+(w+k-a[0])*b.length+j,c[z]=y):(z=(v+g-a[1])*n+w+k-a[0],c[j][z]=y)}})},x=0;x<b.length;++x)w(x);return Promise.all(s).then(function(){return c})}},{key:"readRasters",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=a.window,c=a.samples,d=void 0===c?[]:c,e=a.interleave,f=a.poolSize,h=void 0===f?null:f,i=b||[0,0,this.getWidth(),this.getHeight()],j=new l.default(this.fileDirectory.Compression,h);if(i[0]<0||i[1]<0||i[2]>this.getWidth()||i[3]>this.getHeight())return Promise.reject(new Error("Select window is out of image bounds."));if(i[0]>i[2]||i[1]>i[3])return Promise.reject(new Error("Invalid subsets"));var k=i[2]-i[0],m=i[3]-i[1],n=k*m;if(d){for(var o=0;o<d.length;++o)if(d[o]>=this.fileDirectory.SamplesPerPixel)return Promise.reject(new RangeError("Invalid sample index '"+d[o]+"'."))}else for(var p=0;p<this.fileDirectory.SamplesPerPixel;++p)d.push(p);var q=void 0;if(e){var r=this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,s=Math.max.apply(null,this.fileDirectory.BitsPerSample);q=g(r,s,n*d.length)}else{q=[];for(var t=0;t<d.length;++t)q.push(this.getArrayForSample(d[t],n))}return this._readRaster(i,d,q,e,j).then(function(a){return j.destroy(),a})}},{key:"readRGB",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=a.window,c=a.poolSize,d=b||[0,0,this.getWidth(),this.getHeight()];if(d[0]<0||d[1]<0||d[2]>this.getWidth()||d[3]>this.getHeight())throw new Error("Select window is out of image bounds.");if(d[0]>d[2]||d[1]>d[3])throw new Error("Invalid subsets");var e=d[2]-d[0],f=d[3]-d[1],g=this.fileDirectory.PhotometricInterpretation,h=this.fileDirectory.BitsPerSample[0],k=Math.pow(2,h);if(g===i.photometricInterpretations.RGB)return this.readRasters({window:b,interleave:!0,poolSize:c});var l=void 0;switch(g){case i.photometricInterpretations.WhiteIsZero:case i.photometricInterpretations.BlackIsZero:case i.photometricInterpretations.Palette:l=[0];break;case i.photometricInterpretations.CMYK:l=[0,1,2,3];break;case i.photometricInterpretations.YCbCr:case i.photometricInterpretations.CIELab:l=[0,1,2];break;default:throw new Error("Invalid or unsupported photometric interpretation.")}var m={window:d,interleave:!0,samples:l,poolSize:c},n=this.fileDirectory;return this.readRasters(m).then(function(a){switch(g){case i.photometricInterpretations.WhiteIsZero:return(0,j.fromWhiteIsZero)(a,k,e,f);case i.photometricInterpretations.BlackIsZero:return(0,j.fromBlackIsZero)(a,k,e,f);case i.photometricInterpretations.Palette:return(0,j.fromPalette)(a,n.ColorMap,e,f);case i.photometricInterpretations.CMYK:return(0,j.fromCMYK)(a,e,f);case i.photometricInterpretations.YCbCr:return(0,j.fromYCbCr)(a,e,f);case i.photometricInterpretations.CIELab:return(0,j.fromCIELab)(a,e,f);default:throw new Error("Unsupported photometric interpretation.")}})}},{key:"getTiePoints",value:function(){if(!this.fileDirectory.ModelTiepoint)return[];for(var a=[],b=0;b<this.fileDirectory.ModelTiepoint.length;b+=6)a.push({i:this.fileDirectory.ModelTiepoint[b],j:this.fileDirectory.ModelTiepoint[b+1],k:this.fileDirectory.ModelTiepoint[b+2],x:this.fileDirectory.ModelTiepoint[b+3],y:this.fileDirectory.ModelTiepoint[b+4],z:this.fileDirectory.ModelTiepoint[b+5]});return a}},{key:"getGDALMetadata",value:function(){var a={};if(!this.fileDirectory.GDAL_METADATA)return null;for(var b=this.fileDirectory.GDAL_METADATA,c=(0,i.parseXml)(b.substring(0,b.length-1)),d=c.evaluate("GDALMetadata/Item",c,null,XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,null),e=0;e<d.snapshotLength;++e){var f=d.snapshotItem(e);a[f.getAttribute("name")]=f.textContent}return a}}]),a}();c.default=m},{"./globals":11,"./pool":13,"./rgb":14}],11:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d=c.fieldTagNames={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams"},e=c.fieldTags={};for(var f in d)d.hasOwnProperty(f)&&(e[d[f]]=parseInt(f,10));var g=(c.arrayFields=[e.BitsPerSample,e.ExtraSamples,e.SampleFormat,e.StripByteCounts,e.StripOffsets,e.StripRowCounts,e.TileByteCounts,e.TileOffsets],c.fieldTypeNames={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",16:"LONG8",17:"SLONG8",18:"IFD8"}),h=c.fieldTypes={};for(var i in g)h[g[i]]=parseInt(i,10);var j=(c.photometricInterpretations={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,TransparencyMask:4,CMYK:5,YCbCr:6,CIELab:8,ICCLab:9},c.geoKeyNames={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"}),k=c.geoKeys={};for(var l in j)j.hasOwnProperty(l)&&(k[j[l]]=parseInt(l,10));var m=c.parseXml=void 0;"undefined"==typeof window?c.parseXml=m=function(b){var c=a("xmldom").DOMParser;return(new c).parseFromString(b,"text/xml")}:"undefined"!=typeof window.DOMParser?c.parseXml=m=function(a){return(new window.DOMParser).parseFromString(a,"text/xml")}:"undefined"!=typeof window.ActiveXObject&&new window.ActiveXObject("Microsoft.XMLDOM")&&(c.parseXml=m=function(a){var b=new window.ActiveXObject("Microsoft.XMLDOM");return b.async="false",b.loadXML(a),b})},{xmldom:"xmldom"}],12:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){var c=void 0,d=void 0,e=void 0,f=void 0;if("string"==typeof a||a instanceof String)for(c=new ArrayBuffer(2*a.length),f=new Uint16Array(c),d=0,e=a.length;d<e;++d)f[d]=a.charCodeAt(d);else{if(!(a instanceof ArrayBuffer))throw new Error("Invalid input data given.");c=a}return new g.default(c,b);
}var f=a("./geotiff"),g=d(f);"undefined"!=typeof b&&"undefined"!=typeof b.exports&&(b.exports.parse=e),"undefined"!=typeof window&&(window.GeoTIFF={parse:e})},{"./geotiff":9}],13:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a("webworkify"),h=d(g),i=a("./worker"),j=d(i),k=a("./compression"),l=navigator.hardwareConcurrency,m=function(){function a(b){var c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l;e(this,a),this.compression=b,this.workers=[],this.decoder=null;for(var d=0;d<c;++d){var f=(0,h.default)(j.default);this.workers.push(f)}(null===c||c<1)&&(this.decoder=(0,k.getDecoder)(b))}return f(a,[{key:"decodeBlock",value:function(a){var b=this;return this.decoder?this.decoder.decodeBlock(a):this.waitForWorker().then(function(c){return new Promise(function(d,e){c.onmessage=function(a){b.workers.push(c),d(a.data[0])},c.onerror=function(a){b.workers.push(c),e(a)},c.postMessage(["decode",b.compression,a],[a])})})}},{key:"waitForWorker",value:function(){var a=this,b=10,c=function c(d){a.workers.length?d(a.workers.pop()):setTimeout(c,b,d)};return new Promise(function(a){c(a)})}},{key:"destroy",value:function(){for(var a=0;a<this.workers.length;++a)this.workers[a].terminate()}}]),a}();c.default=m},{"./compression":4,"./worker":15,webworkify:1}],14:[function(a,b,c){"use strict";function d(a,b,c,d){for(var e=new Uint8Array(c*d*3),f=void 0,g=0,h=0;g<a.length;++g,h+=3)f=256-a[g]/b*256,e[h]=f,e[h+1]=f,e[h+2]=f;return e}function e(a,b,c,d){for(var e=new Uint8Array(c*d*3),f=void 0,g=0,h=0;g<a.length;++g,h+=3)f=a[g]/b*256,e[h]=f,e[h+1]=f,e[h+2]=f;return e}function f(a,b,c,d){for(var e=new Uint8Array(c*d*3),f=b.length/3,g=b.length/3*2,h=0,i=0;h<a.length;++h,i+=3){var j=a[h];e[i]=b[j]/65536*256,e[i+1]=b[j+f]/65536*256,e[i+2]=b[j+g]/65536*256}return e}function g(a,b,c){for(var d=new Uint8Array(b*c*3),e=0,f=0;e<a.length;e+=4,f+=3){var g=a[e],h=a[e+1],i=a[e+2],j=a[e+3];d[f]=255*((255-g)/256)*((255-j)/256),d[f+1]=255*((255-h)/256)*((255-j)/256),d[f+2]=255*((255-i)/256)*((255-j)/256)}return d}function h(a,b,c){for(var d=new Uint8Array(b*c*3),e=0,f=0;e<a.length;e+=3,f+=3){var g=a[e],h=a[e+1],i=a[e+2];d[f]=g+1.402*(i-128),d[f+1]=g-.34414*(h-128)-.71414*(i-128),d[f+2]=g+1.772*(h-128)}return d}function i(a,b,c){for(var d=.008856,e=.206893,f=[3.240479,-1.53715,-.498535,-.969256,1.875992,.041556,.055648,-.204043,1.057311],g=new Uint8Array(b*c*3),h=0,i=0;h<a.length;h+=3,i+=3){var j=a[h],k=a[h+1],l=a[h+2],m=Math.pow((j+16)/116,3),n=m>d;m=(0!==n)*(j/903.3)+n*m;var o=m;m=n*Math.pow(m,1/3)+(0!==n)*(7.787*m+16/116);var p=k/500+m,q=p>e,r=q*Math.pow(p,3)+(0!==q)*((p-16/116)/7.787),s=m-l/200,t=s>e,u=t*Math.pow(s,3)+(0!==t)*((s-16/116)/7.787);r*=.950456,u*=1.088754,g[i]=r*f[0]+o*f[1]+u*f[2],g[i+1]=r*f[3]+o*f[4]+u*f[5],g[i+2]=r*f[6]+o*f[7]+u*f[8]}return g}Object.defineProperty(c,"__esModule",{value:!0}),c.fromWhiteIsZero=d,c.fromBlackIsZero=e,c.fromPalette=f,c.fromCMYK=g,c.fromYCbCr=h,c.fromCIELab=i},{}],15:[function(a,b,c){"use strict";function d(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function e(a){return Array.isArray(a)?a:Array.from(a)}function f(a,b,c){var d=(0,g.getDecoder)(b);d.decodeBlock(c).then(function(b){a.postMessage([b],[b])})}Object.defineProperty(c,"__esModule",{value:!0}),c.default=function(a){a.addEventListener("message",function(b){var c=e(b.data),g=c[0],h=c.slice(1);switch(g){case"decode":f.apply(void 0,[a].concat(d(h)))}})};var g=a("./compression")},{"./compression":4}]},{},[12]);