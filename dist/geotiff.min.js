(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){"use strict";var zlib_inflate=require("./zlib/inflate");var utils=require("./utils/common");var strings=require("./utils/strings");var c=require("./zlib/constants");var msg=require("./zlib/messages");var ZStream=require("./zlib/zstream");var GZheader=require("./zlib/gzheader");var toString=Object.prototype.toString;function Inflate(options){if(!(this instanceof Inflate))return new Inflate(options);this.options=utils.assign({chunkSize:16384,windowBits:0,to:""},options||{});var opt=this.options;if(opt.raw&&opt.windowBits>=0&&opt.windowBits<16){opt.windowBits=-opt.windowBits;if(opt.windowBits===0){opt.windowBits=-15}}if(opt.windowBits>=0&&opt.windowBits<16&&!(options&&options.windowBits)){opt.windowBits+=32}if(opt.windowBits>15&&opt.windowBits<48){if((opt.windowBits&15)===0){opt.windowBits|=15}}this.err=0;this.msg="";this.ended=false;this.chunks=[];this.strm=new ZStream;this.strm.avail_out=0;var status=zlib_inflate.inflateInit2(this.strm,opt.windowBits);if(status!==c.Z_OK){throw new Error(msg[status])}this.header=new GZheader;zlib_inflate.inflateGetHeader(this.strm,this.header)}Inflate.prototype.push=function(data,mode){var strm=this.strm;var chunkSize=this.options.chunkSize;var dictionary=this.options.dictionary;var status,_mode;var next_out_utf8,tail,utf8str;var dict;var allowBufError=false;if(this.ended){return false}_mode=mode===~~mode?mode:mode===true?c.Z_FINISH:c.Z_NO_FLUSH;if(typeof data==="string"){strm.input=strings.binstring2buf(data)}else if(toString.call(data)==="[object ArrayBuffer]"){strm.input=new Uint8Array(data)}else{strm.input=data}strm.next_in=0;strm.avail_in=strm.input.length;do{if(strm.avail_out===0){strm.output=new utils.Buf8(chunkSize);strm.next_out=0;strm.avail_out=chunkSize}status=zlib_inflate.inflate(strm,c.Z_NO_FLUSH);if(status===c.Z_NEED_DICT&&dictionary){if(typeof dictionary==="string"){dict=strings.string2buf(dictionary)}else if(toString.call(dictionary)==="[object ArrayBuffer]"){dict=new Uint8Array(dictionary)}else{dict=dictionary}status=zlib_inflate.inflateSetDictionary(this.strm,dict)}if(status===c.Z_BUF_ERROR&&allowBufError===true){status=c.Z_OK;allowBufError=false}if(status!==c.Z_STREAM_END&&status!==c.Z_OK){this.onEnd(status);this.ended=true;return false}if(strm.next_out){if(strm.avail_out===0||status===c.Z_STREAM_END||strm.avail_in===0&&(_mode===c.Z_FINISH||_mode===c.Z_SYNC_FLUSH)){if(this.options.to==="string"){next_out_utf8=strings.utf8border(strm.output,strm.next_out);tail=strm.next_out-next_out_utf8;utf8str=strings.buf2string(strm.output,next_out_utf8);strm.next_out=tail;strm.avail_out=chunkSize-tail;if(tail){utils.arraySet(strm.output,strm.output,next_out_utf8,tail,0)}this.onData(utf8str)}else{this.onData(utils.shrinkBuf(strm.output,strm.next_out))}}}if(strm.avail_in===0&&strm.avail_out===0){allowBufError=true}}while((strm.avail_in>0||strm.avail_out===0)&&status!==c.Z_STREAM_END);if(status===c.Z_STREAM_END){_mode=c.Z_FINISH}if(_mode===c.Z_FINISH){status=zlib_inflate.inflateEnd(this.strm);this.onEnd(status);this.ended=true;return status===c.Z_OK}if(_mode===c.Z_SYNC_FLUSH){this.onEnd(c.Z_OK);strm.avail_out=0;return true}return true};Inflate.prototype.onData=function(chunk){this.chunks.push(chunk)};Inflate.prototype.onEnd=function(status){if(status===c.Z_OK){if(this.options.to==="string"){this.result=this.chunks.join("")}else{this.result=utils.flattenChunks(this.chunks)}}this.chunks=[];this.err=status;this.msg=this.strm.msg};function inflate(input,options){var inflator=new Inflate(options);inflator.push(input,true);if(inflator.err){throw inflator.msg}return inflator.result}function inflateRaw(input,options){options=options||{};options.raw=true;return inflate(input,options)}exports.Inflate=Inflate;exports.inflate=inflate;exports.inflateRaw=inflateRaw;exports.ungzip=inflate},{"./utils/common":2,"./utils/strings":3,"./zlib/constants":5,"./zlib/gzheader":7,"./zlib/inflate":9,"./zlib/messages":11,"./zlib/zstream":12}],2:[function(require,module,exports){"use strict";var TYPED_OK=typeof Uint8Array!=="undefined"&&typeof Uint16Array!=="undefined"&&typeof Int32Array!=="undefined";exports.assign=function(obj){var sources=Array.prototype.slice.call(arguments,1);while(sources.length){var source=sources.shift();if(!source){continue}if(typeof source!=="object"){throw new TypeError(source+"must be non-object")}for(var p in source){if(source.hasOwnProperty(p)){obj[p]=source[p]}}}return obj};exports.shrinkBuf=function(buf,size){if(buf.length===size){return buf}if(buf.subarray){return buf.subarray(0,size)}buf.length=size;return buf};var fnTyped={arraySet:function(dest,src,src_offs,len,dest_offs){if(src.subarray&&dest.subarray){dest.set(src.subarray(src_offs,src_offs+len),dest_offs);return}for(var i=0;i<len;i++){dest[dest_offs+i]=src[src_offs+i]}},flattenChunks:function(chunks){var i,l,len,pos,chunk,result;len=0;for(i=0,l=chunks.length;i<l;i++){len+=chunks[i].length}result=new Uint8Array(len);pos=0;for(i=0,l=chunks.length;i<l;i++){chunk=chunks[i];result.set(chunk,pos);pos+=chunk.length}return result}};var fnUntyped={arraySet:function(dest,src,src_offs,len,dest_offs){for(var i=0;i<len;i++){dest[dest_offs+i]=src[src_offs+i]}},flattenChunks:function(chunks){return[].concat.apply([],chunks)}};exports.setTyped=function(on){if(on){exports.Buf8=Uint8Array;exports.Buf16=Uint16Array;exports.Buf32=Int32Array;exports.assign(exports,fnTyped)}else{exports.Buf8=Array;exports.Buf16=Array;exports.Buf32=Array;exports.assign(exports,fnUntyped)}};exports.setTyped(TYPED_OK)},{}],3:[function(require,module,exports){"use strict";var utils=require("./common");var STR_APPLY_OK=true;var STR_APPLY_UIA_OK=true;try{String.fromCharCode.apply(null,[0])}catch(__){STR_APPLY_OK=false}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(__){STR_APPLY_UIA_OK=false}var _utf8len=new utils.Buf8(256);for(var q=0;q<256;q++){_utf8len[q]=q>=252?6:q>=248?5:q>=240?4:q>=224?3:q>=192?2:1}_utf8len[254]=_utf8len[254]=1;exports.string2buf=function(str){var buf,c,c2,m_pos,i,str_len=str.length,buf_len=0;for(m_pos=0;m_pos<str_len;m_pos++){c=str.charCodeAt(m_pos);if((c&64512)===55296&&m_pos+1<str_len){c2=str.charCodeAt(m_pos+1);if((c2&64512)===56320){c=65536+(c-55296<<10)+(c2-56320);m_pos++}}buf_len+=c<128?1:c<2048?2:c<65536?3:4}buf=new utils.Buf8(buf_len);for(i=0,m_pos=0;i<buf_len;m_pos++){c=str.charCodeAt(m_pos);if((c&64512)===55296&&m_pos+1<str_len){c2=str.charCodeAt(m_pos+1);if((c2&64512)===56320){c=65536+(c-55296<<10)+(c2-56320);m_pos++}}if(c<128){buf[i++]=c}else if(c<2048){buf[i++]=192|c>>>6;buf[i++]=128|c&63}else if(c<65536){buf[i++]=224|c>>>12;buf[i++]=128|c>>>6&63;buf[i++]=128|c&63}else{buf[i++]=240|c>>>18;buf[i++]=128|c>>>12&63;buf[i++]=128|c>>>6&63;buf[i++]=128|c&63}}return buf};function buf2binstring(buf,len){if(len<65537){if(buf.subarray&&STR_APPLY_UIA_OK||!buf.subarray&&STR_APPLY_OK){return String.fromCharCode.apply(null,utils.shrinkBuf(buf,len))}}var result="";for(var i=0;i<len;i++){result+=String.fromCharCode(buf[i])}return result}exports.buf2binstring=function(buf){return buf2binstring(buf,buf.length)};exports.binstring2buf=function(str){var buf=new utils.Buf8(str.length);for(var i=0,len=buf.length;i<len;i++){buf[i]=str.charCodeAt(i)}return buf};exports.buf2string=function(buf,max){var i,out,c,c_len;var len=max||buf.length;var utf16buf=new Array(len*2);for(out=0,i=0;i<len;){c=buf[i++];if(c<128){utf16buf[out++]=c;continue}c_len=_utf8len[c];if(c_len>4){utf16buf[out++]=65533;i+=c_len-1;continue}c&=c_len===2?31:c_len===3?15:7;while(c_len>1&&i<len){c=c<<6|buf[i++]&63;c_len--}if(c_len>1){utf16buf[out++]=65533;continue}if(c<65536){utf16buf[out++]=c}else{c-=65536;utf16buf[out++]=55296|c>>10&1023;utf16buf[out++]=56320|c&1023}}return buf2binstring(utf16buf,out)};exports.utf8border=function(buf,max){var pos;max=max||buf.length;if(max>buf.length){max=buf.length}pos=max-1;while(pos>=0&&(buf[pos]&192)===128){pos--}if(pos<0){return max}if(pos===0){return max}return pos+_utf8len[buf[pos]]>max?pos:max}},{"./common":2}],4:[function(require,module,exports){"use strict";function adler32(adler,buf,len,pos){var s1=adler&65535|0,s2=adler>>>16&65535|0,n=0;while(len!==0){n=len>2e3?2e3:len;len-=n;do{s1=s1+buf[pos++]|0;s2=s2+s1|0}while(--n);s1%=65521;s2%=65521}return s1|s2<<16|0}module.exports=adler32},{}],5:[function(require,module,exports){"use strict";module.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],6:[function(require,module,exports){"use strict";function makeTable(){var c,table=[];for(var n=0;n<256;n++){c=n;for(var k=0;k<8;k++){c=c&1?3988292384^c>>>1:c>>>1}table[n]=c}return table}var crcTable=makeTable();function crc32(crc,buf,len,pos){var t=crcTable,end=pos+len;crc^=-1;for(var i=pos;i<end;i++){crc=crc>>>8^t[(crc^buf[i])&255]}return crc^-1}module.exports=crc32},{}],7:[function(require,module,exports){"use strict";function GZheader(){this.text=0;this.time=0;this.xflags=0;this.os=0;this.extra=null;this.extra_len=0;this.name="";this.comment="";this.hcrc=0;this.done=false}module.exports=GZheader},{}],8:[function(require,module,exports){"use strict";var BAD=30;var TYPE=12;module.exports=function inflate_fast(strm,start){var state;var _in;var last;var _out;var beg;var end;var dmax;var wsize;var whave;var wnext;var s_window;var hold;var bits;var lcode;var dcode;var lmask;var dmask;var here;var op;var len;var dist;var from;var from_source;var input,output;state=strm.state;_in=strm.next_in;input=strm.input;last=_in+(strm.avail_in-5);_out=strm.next_out;output=strm.output;beg=_out-(start-strm.avail_out);end=_out+(strm.avail_out-257);dmax=state.dmax;wsize=state.wsize;whave=state.whave;wnext=state.wnext;s_window=state.window;hold=state.hold;bits=state.bits;lcode=state.lencode;dcode=state.distcode;lmask=(1<<state.lenbits)-1;dmask=(1<<state.distbits)-1;top:do{if(bits<15){hold+=input[_in++]<<bits;bits+=8;hold+=input[_in++]<<bits;bits+=8}here=lcode[hold&lmask];dolen:for(;;){op=here>>>24;hold>>>=op;bits-=op;op=here>>>16&255;if(op===0){output[_out++]=here&65535}else if(op&16){len=here&65535;op&=15;if(op){if(bits<op){hold+=input[_in++]<<bits;bits+=8}len+=hold&(1<<op)-1;hold>>>=op;bits-=op}if(bits<15){hold+=input[_in++]<<bits;bits+=8;hold+=input[_in++]<<bits;bits+=8}here=dcode[hold&dmask];dodist:for(;;){op=here>>>24;hold>>>=op;bits-=op;op=here>>>16&255;if(op&16){dist=here&65535;op&=15;if(bits<op){hold+=input[_in++]<<bits;bits+=8;if(bits<op){hold+=input[_in++]<<bits;bits+=8}}dist+=hold&(1<<op)-1;if(dist>dmax){strm.msg="invalid distance too far back";state.mode=BAD;break top}hold>>>=op;bits-=op;op=_out-beg;if(dist>op){op=dist-op;if(op>whave){if(state.sane){strm.msg="invalid distance too far back";state.mode=BAD;break top}}from=0;from_source=s_window;if(wnext===0){from+=wsize-op;if(op<len){len-=op;do{output[_out++]=s_window[from++]}while(--op);from=_out-dist;from_source=output}}else if(wnext<op){from+=wsize+wnext-op;op-=wnext;if(op<len){len-=op;do{output[_out++]=s_window[from++]}while(--op);from=0;if(wnext<len){op=wnext;len-=op;do{output[_out++]=s_window[from++]}while(--op);from=_out-dist;from_source=output}}}else{from+=wnext-op;if(op<len){len-=op;do{output[_out++]=s_window[from++]}while(--op);from=_out-dist;from_source=output}}while(len>2){output[_out++]=from_source[from++];output[_out++]=from_source[from++];output[_out++]=from_source[from++];len-=3}if(len){output[_out++]=from_source[from++];if(len>1){output[_out++]=from_source[from++]}}}else{from=_out-dist;do{output[_out++]=output[from++];output[_out++]=output[from++];output[_out++]=output[from++];len-=3}while(len>2);if(len){output[_out++]=output[from++];if(len>1){output[_out++]=output[from++]}}}}else if((op&64)===0){here=dcode[(here&65535)+(hold&(1<<op)-1)];continue dodist}else{strm.msg="invalid distance code";state.mode=BAD;break top}break}}else if((op&64)===0){here=lcode[(here&65535)+(hold&(1<<op)-1)];continue dolen}else if(op&32){state.mode=TYPE;break top}else{strm.msg="invalid literal/length code";state.mode=BAD;break top}break}}while(_in<last&&_out<end);len=bits>>3;_in-=len;bits-=len<<3;hold&=(1<<bits)-1;strm.next_in=_in;strm.next_out=_out;strm.avail_in=_in<last?5+(last-_in):5-(_in-last);strm.avail_out=_out<end?257+(end-_out):257-(_out-end);state.hold=hold;state.bits=bits;return}},{}],9:[function(require,module,exports){"use strict";var utils=require("../utils/common");var adler32=require("./adler32");var crc32=require("./crc32");var inflate_fast=require("./inffast");var inflate_table=require("./inftrees");var CODES=0;var LENS=1;var DISTS=2;var Z_FINISH=4;var Z_BLOCK=5;var Z_TREES=6;var Z_OK=0;var Z_STREAM_END=1;var Z_NEED_DICT=2;var Z_STREAM_ERROR=-2;var Z_DATA_ERROR=-3;var Z_MEM_ERROR=-4;var Z_BUF_ERROR=-5;var Z_DEFLATED=8;var HEAD=1;var FLAGS=2;var TIME=3;var OS=4;var EXLEN=5;var EXTRA=6;var NAME=7;var COMMENT=8;var HCRC=9;var DICTID=10;var DICT=11;var TYPE=12;var TYPEDO=13;var STORED=14;var COPY_=15;var COPY=16;var TABLE=17;var LENLENS=18;var CODELENS=19;var LEN_=20;var LEN=21;var LENEXT=22;var DIST=23;var DISTEXT=24;var MATCH=25;var LIT=26;var CHECK=27;var LENGTH=28;var DONE=29;var BAD=30;var MEM=31;var SYNC=32;var ENOUGH_LENS=852;var ENOUGH_DISTS=592;var MAX_WBITS=15;var DEF_WBITS=MAX_WBITS;function zswap32(q){return(q>>>24&255)+(q>>>8&65280)+((q&65280)<<8)+((q&255)<<24)}function InflateState(){this.mode=0;this.last=false;this.wrap=0;this.havedict=false;this.flags=0;this.dmax=0;this.check=0;this.total=0;this.head=null;this.wbits=0;this.wsize=0;this.whave=0;this.wnext=0;this.window=null;this.hold=0;this.bits=0;this.length=0;this.offset=0;this.extra=0;this.lencode=null;this.distcode=null;this.lenbits=0;this.distbits=0;this.ncode=0;this.nlen=0;this.ndist=0;this.have=0;this.next=null;this.lens=new utils.Buf16(320);this.work=new utils.Buf16(288);this.lendyn=null;this.distdyn=null;this.sane=0;this.back=0;this.was=0}function inflateResetKeep(strm){var state;if(!strm||!strm.state){return Z_STREAM_ERROR}state=strm.state;strm.total_in=strm.total_out=state.total=0;strm.msg="";if(state.wrap){strm.adler=state.wrap&1}state.mode=HEAD;state.last=0;state.havedict=0;state.dmax=32768;state.head=null;state.hold=0;state.bits=0;state.lencode=state.lendyn=new utils.Buf32(ENOUGH_LENS);state.distcode=state.distdyn=new utils.Buf32(ENOUGH_DISTS);state.sane=1;state.back=-1;return Z_OK}function inflateReset(strm){var state;if(!strm||!strm.state){return Z_STREAM_ERROR}state=strm.state;state.wsize=0;state.whave=0;state.wnext=0;return inflateResetKeep(strm)}function inflateReset2(strm,windowBits){var wrap;var state;if(!strm||!strm.state){return Z_STREAM_ERROR}state=strm.state;if(windowBits<0){wrap=0;windowBits=-windowBits}else{wrap=(windowBits>>4)+1;if(windowBits<48){windowBits&=15}}if(windowBits&&(windowBits<8||windowBits>15)){return Z_STREAM_ERROR}if(state.window!==null&&state.wbits!==windowBits){state.window=null}state.wrap=wrap;state.wbits=windowBits;return inflateReset(strm)}function inflateInit2(strm,windowBits){var ret;var state;if(!strm){return Z_STREAM_ERROR}state=new InflateState;strm.state=state;state.window=null;ret=inflateReset2(strm,windowBits);if(ret!==Z_OK){strm.state=null}return ret}function inflateInit(strm){return inflateInit2(strm,DEF_WBITS)}var virgin=true;var lenfix,distfix;function fixedtables(state){if(virgin){var sym;lenfix=new utils.Buf32(512);distfix=new utils.Buf32(32);sym=0;while(sym<144){state.lens[sym++]=8}while(sym<256){state.lens[sym++]=9}while(sym<280){state.lens[sym++]=7}while(sym<288){state.lens[sym++]=8}inflate_table(LENS,state.lens,0,288,lenfix,0,state.work,{bits:9});sym=0;while(sym<32){state.lens[sym++]=5}inflate_table(DISTS,state.lens,0,32,distfix,0,state.work,{bits:5});virgin=false}state.lencode=lenfix;state.lenbits=9;state.distcode=distfix;state.distbits=5}function updatewindow(strm,src,end,copy){var dist;var state=strm.state;if(state.window===null){state.wsize=1<<state.wbits;state.wnext=0;state.whave=0;state.window=new utils.Buf8(state.wsize)}if(copy>=state.wsize){utils.arraySet(state.window,src,end-state.wsize,state.wsize,0);state.wnext=0;state.whave=state.wsize}else{dist=state.wsize-state.wnext;if(dist>copy){dist=copy}utils.arraySet(state.window,src,end-copy,dist,state.wnext);copy-=dist;if(copy){utils.arraySet(state.window,src,end-copy,copy,0);state.wnext=copy;state.whave=state.wsize}else{state.wnext+=dist;if(state.wnext===state.wsize){state.wnext=0}if(state.whave<state.wsize){state.whave+=dist}}}return 0}function inflate(strm,flush){var state;var input,output;var next;var put;var have,left;var hold;var bits;var _in,_out;var copy;var from;var from_source;var here=0;var here_bits,here_op,here_val;var last_bits,last_op,last_val;var len;var ret;var hbuf=new utils.Buf8(4);var opts;var n;var order=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!strm||!strm.state||!strm.output||!strm.input&&strm.avail_in!==0){return Z_STREAM_ERROR}state=strm.state;if(state.mode===TYPE){state.mode=TYPEDO}put=strm.next_out;output=strm.output;left=strm.avail_out;next=strm.next_in;input=strm.input;have=strm.avail_in;hold=state.hold;bits=state.bits;_in=have;_out=left;ret=Z_OK;inf_leave:for(;;){switch(state.mode){case HEAD:if(state.wrap===0){state.mode=TYPEDO;break}while(bits<16){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(state.wrap&2&&hold===35615){state.check=0;hbuf[0]=hold&255;hbuf[1]=hold>>>8&255;state.check=crc32(state.check,hbuf,2,0);hold=0;bits=0;state.mode=FLAGS;break}state.flags=0;if(state.head){state.head.done=false}if(!(state.wrap&1)||(((hold&255)<<8)+(hold>>8))%31){strm.msg="incorrect header check";state.mode=BAD;break}if((hold&15)!==Z_DEFLATED){strm.msg="unknown compression method";state.mode=BAD;break}hold>>>=4;bits-=4;len=(hold&15)+8;if(state.wbits===0){state.wbits=len}else if(len>state.wbits){strm.msg="invalid window size";state.mode=BAD;break}state.dmax=1<<len;strm.adler=state.check=1;state.mode=hold&512?DICTID:TYPE;hold=0;bits=0;break;case FLAGS:while(bits<16){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state.flags=hold;if((state.flags&255)!==Z_DEFLATED){strm.msg="unknown compression method";state.mode=BAD;break}if(state.flags&57344){strm.msg="unknown header flags set";state.mode=BAD;break}if(state.head){state.head.text=hold>>8&1}if(state.flags&512){hbuf[0]=hold&255;hbuf[1]=hold>>>8&255;state.check=crc32(state.check,hbuf,2,0)}hold=0;bits=0;state.mode=TIME;case TIME:while(bits<32){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(state.head){state.head.time=hold}if(state.flags&512){hbuf[0]=hold&255;hbuf[1]=hold>>>8&255;hbuf[2]=hold>>>16&255;hbuf[3]=hold>>>24&255;state.check=crc32(state.check,hbuf,4,0)}hold=0;bits=0;state.mode=OS;case OS:while(bits<16){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(state.head){state.head.xflags=hold&255;state.head.os=hold>>8}if(state.flags&512){hbuf[0]=hold&255;hbuf[1]=hold>>>8&255;state.check=crc32(state.check,hbuf,2,0)}hold=0;bits=0;state.mode=EXLEN;case EXLEN:if(state.flags&1024){while(bits<16){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state.length=hold;if(state.head){state.head.extra_len=hold}if(state.flags&512){hbuf[0]=hold&255;hbuf[1]=hold>>>8&255;state.check=crc32(state.check,hbuf,2,0)}hold=0;bits=0}else if(state.head){state.head.extra=null}state.mode=EXTRA;case EXTRA:if(state.flags&1024){copy=state.length;if(copy>have){copy=have}if(copy){if(state.head){len=state.head.extra_len-state.length;if(!state.head.extra){state.head.extra=new Array(state.head.extra_len)}utils.arraySet(state.head.extra,input,next,copy,len)}if(state.flags&512){state.check=crc32(state.check,input,copy,next)}have-=copy;next+=copy;state.length-=copy}if(state.length){break inf_leave}}state.length=0;state.mode=NAME;case NAME:if(state.flags&2048){if(have===0){break inf_leave}copy=0;do{len=input[next+copy++];if(state.head&&len&&state.length<65536){state.head.name+=String.fromCharCode(len)}}while(len&&copy<have);if(state.flags&512){state.check=crc32(state.check,input,copy,next)}have-=copy;next+=copy;if(len){break inf_leave}}else if(state.head){state.head.name=null}state.length=0;state.mode=COMMENT;case COMMENT:if(state.flags&4096){if(have===0){break inf_leave}copy=0;do{len=input[next+copy++];if(state.head&&len&&state.length<65536){state.head.comment+=String.fromCharCode(len)}}while(len&&copy<have);if(state.flags&512){state.check=crc32(state.check,input,copy,next)}have-=copy;next+=copy;if(len){break inf_leave}}else if(state.head){state.head.comment=null}state.mode=HCRC;case HCRC:if(state.flags&512){while(bits<16){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(hold!==(state.check&65535)){strm.msg="header crc mismatch";state.mode=BAD;break}hold=0;bits=0}if(state.head){state.head.hcrc=state.flags>>9&1;state.head.done=true}strm.adler=state.check=0;state.mode=TYPE;break;case DICTID:while(bits<32){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}strm.adler=state.check=zswap32(hold);hold=0;bits=0;state.mode=DICT;case DICT:if(state.havedict===0){strm.next_out=put;strm.avail_out=left;strm.next_in=next;strm.avail_in=have;state.hold=hold;state.bits=bits;return Z_NEED_DICT}strm.adler=state.check=1;state.mode=TYPE;case TYPE:if(flush===Z_BLOCK||flush===Z_TREES){break inf_leave}case TYPEDO:if(state.last){hold>>>=bits&7;bits-=bits&7;state.mode=CHECK;break}while(bits<3){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state.last=hold&1;hold>>>=1;bits-=1;switch(hold&3){case 0:state.mode=STORED;break;case 1:fixedtables(state);state.mode=LEN_;if(flush===Z_TREES){hold>>>=2;bits-=2;break inf_leave}break;case 2:state.mode=TABLE;break;case 3:strm.msg="invalid block type";state.mode=BAD}hold>>>=2;bits-=2;break;case STORED:hold>>>=bits&7;bits-=bits&7;while(bits<32){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if((hold&65535)!==(hold>>>16^65535)){strm.msg="invalid stored block lengths";state.mode=BAD;break}state.length=hold&65535;hold=0;bits=0;state.mode=COPY_;if(flush===Z_TREES){break inf_leave}case COPY_:state.mode=COPY;case COPY:copy=state.length;if(copy){if(copy>have){copy=have}if(copy>left){copy=left}if(copy===0){break inf_leave}utils.arraySet(output,input,next,copy,put);have-=copy;next+=copy;left-=copy;put+=copy;state.length-=copy;break}state.mode=TYPE;break;case TABLE:while(bits<14){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state.nlen=(hold&31)+257;hold>>>=5;bits-=5;state.ndist=(hold&31)+1;hold>>>=5;bits-=5;state.ncode=(hold&15)+4;hold>>>=4;bits-=4;if(state.nlen>286||state.ndist>30){strm.msg="too many length or distance symbols";state.mode=BAD;break}state.have=0;state.mode=LENLENS;case LENLENS:while(state.have<state.ncode){while(bits<3){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state.lens[order[state.have++]]=hold&7;hold>>>=3;bits-=3}while(state.have<19){state.lens[order[state.have++]]=0}state.lencode=state.lendyn;state.lenbits=7;opts={bits:state.lenbits};ret=inflate_table(CODES,state.lens,0,19,state.lencode,0,state.work,opts);state.lenbits=opts.bits;if(ret){strm.msg="invalid code lengths set";state.mode=BAD;break}state.have=0;state.mode=CODELENS;case CODELENS:while(state.have<state.nlen+state.ndist){for(;;){here=state.lencode[hold&(1<<state.lenbits)-1];here_bits=here>>>24;here_op=here>>>16&255;here_val=here&65535;if(here_bits<=bits){break}if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(here_val<16){hold>>>=here_bits;bits-=here_bits;state.lens[state.have++]=here_val}else{if(here_val===16){n=here_bits+2;while(bits<n){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}hold>>>=here_bits;bits-=here_bits;if(state.have===0){strm.msg="invalid bit length repeat";state.mode=BAD;break}len=state.lens[state.have-1];copy=3+(hold&3);hold>>>=2;bits-=2}else if(here_val===17){n=here_bits+3;while(bits<n){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}hold>>>=here_bits;bits-=here_bits;len=0;copy=3+(hold&7);hold>>>=3;bits-=3}else{n=here_bits+7;while(bits<n){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}hold>>>=here_bits;bits-=here_bits;len=0;copy=11+(hold&127);hold>>>=7;bits-=7}if(state.have+copy>state.nlen+state.ndist){strm.msg="invalid bit length repeat";state.mode=BAD;break}while(copy--){state.lens[state.have++]=len}}}if(state.mode===BAD){break}if(state.lens[256]===0){strm.msg="invalid code -- missing end-of-block";state.mode=BAD;break}state.lenbits=9;opts={bits:state.lenbits};ret=inflate_table(LENS,state.lens,0,state.nlen,state.lencode,0,state.work,opts);state.lenbits=opts.bits;if(ret){strm.msg="invalid literal/lengths set";state.mode=BAD;break}state.distbits=6;state.distcode=state.distdyn;opts={bits:state.distbits};ret=inflate_table(DISTS,state.lens,state.nlen,state.ndist,state.distcode,0,state.work,opts);state.distbits=opts.bits;if(ret){strm.msg="invalid distances set";state.mode=BAD;break}state.mode=LEN_;if(flush===Z_TREES){break inf_leave}case LEN_:state.mode=LEN;case LEN:if(have>=6&&left>=258){strm.next_out=put;strm.avail_out=left;strm.next_in=next;strm.avail_in=have;state.hold=hold;state.bits=bits;inflate_fast(strm,_out);put=strm.next_out;output=strm.output;left=strm.avail_out;next=strm.next_in;input=strm.input;have=strm.avail_in;hold=state.hold;bits=state.bits;if(state.mode===TYPE){state.back=-1}break}state.back=0;for(;;){here=state.lencode[hold&(1<<state.lenbits)-1];here_bits=here>>>24;here_op=here>>>16&255;here_val=here&65535;if(here_bits<=bits){break}if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(here_op&&(here_op&240)===0){last_bits=here_bits;last_op=here_op;last_val=here_val;for(;;){here=state.lencode[last_val+((hold&(1<<last_bits+last_op)-1)>>last_bits)];here_bits=here>>>24;here_op=here>>>16&255;here_val=here&65535;if(last_bits+here_bits<=bits){break}if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}hold>>>=last_bits;bits-=last_bits;state.back+=last_bits}hold>>>=here_bits;bits-=here_bits;state.back+=here_bits;state.length=here_val;if(here_op===0){state.mode=LIT;break}if(here_op&32){state.back=-1;state.mode=TYPE;break}if(here_op&64){strm.msg="invalid literal/length code";state.mode=BAD;break}state.extra=here_op&15;state.mode=LENEXT;case LENEXT:if(state.extra){n=state.extra;while(bits<n){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state.length+=hold&(1<<state.extra)-1;hold>>>=state.extra;bits-=state.extra;state.back+=state.extra}state.was=state.length;state.mode=DIST;case DIST:for(;;){here=state.distcode[hold&(1<<state.distbits)-1];here_bits=here>>>24;here_op=here>>>16&255;here_val=here&65535;if(here_bits<=bits){break}if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if((here_op&240)===0){last_bits=here_bits;last_op=here_op;last_val=here_val;for(;;){here=state.distcode[last_val+((hold&(1<<last_bits+last_op)-1)>>last_bits)];here_bits=here>>>24;here_op=here>>>16&255;here_val=here&65535;if(last_bits+here_bits<=bits){break}if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}hold>>>=last_bits;bits-=last_bits;state.back+=last_bits}hold>>>=here_bits;bits-=here_bits;state.back+=here_bits;if(here_op&64){strm.msg="invalid distance code";state.mode=BAD;break}state.offset=here_val;state.extra=here_op&15;state.mode=DISTEXT;case DISTEXT:if(state.extra){n=state.extra;while(bits<n){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state.offset+=hold&(1<<state.extra)-1;hold>>>=state.extra;bits-=state.extra;state.back+=state.extra}if(state.offset>state.dmax){strm.msg="invalid distance too far back";state.mode=BAD;break}state.mode=MATCH;case MATCH:if(left===0){break inf_leave}copy=_out-left;if(state.offset>copy){copy=state.offset-copy;if(copy>state.whave){if(state.sane){strm.msg="invalid distance too far back";state.mode=BAD;break}}if(copy>state.wnext){copy-=state.wnext;from=state.wsize-copy}else{from=state.wnext-copy}if(copy>state.length){copy=state.length}from_source=state.window}else{from_source=output;from=put-state.offset;copy=state.length}if(copy>left){copy=left}left-=copy;state.length-=copy;do{output[put++]=from_source[from++]}while(--copy);if(state.length===0){state.mode=LEN}break;case LIT:if(left===0){break inf_leave}output[put++]=state.length;left--;state.mode=LEN;break;case CHECK:if(state.wrap){while(bits<32){if(have===0){break inf_leave}have--;hold|=input[next++]<<bits;bits+=8}_out-=left;strm.total_out+=_out;state.total+=_out;if(_out){strm.adler=state.check=state.flags?crc32(state.check,output,_out,put-_out):adler32(state.check,output,_out,put-_out)}_out=left;if((state.flags?hold:zswap32(hold))!==state.check){strm.msg="incorrect data check";state.mode=BAD;break}hold=0;bits=0}state.mode=LENGTH;case LENGTH:if(state.wrap&&state.flags){while(bits<32){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(hold!==(state.total&4294967295)){strm.msg="incorrect length check";state.mode=BAD;break}hold=0;bits=0}state.mode=DONE;case DONE:ret=Z_STREAM_END;break inf_leave;case BAD:ret=Z_DATA_ERROR;break inf_leave;case MEM:return Z_MEM_ERROR;case SYNC:default:return Z_STREAM_ERROR}}strm.next_out=put;strm.avail_out=left;strm.next_in=next;strm.avail_in=have;state.hold=hold;state.bits=bits;if(state.wsize||_out!==strm.avail_out&&state.mode<BAD&&(state.mode<CHECK||flush!==Z_FINISH)){if(updatewindow(strm,strm.output,strm.next_out,_out-strm.avail_out)){state.mode=MEM;return Z_MEM_ERROR}}_in-=strm.avail_in;_out-=strm.avail_out;strm.total_in+=_in;strm.total_out+=_out;state.total+=_out;if(state.wrap&&_out){strm.adler=state.check=state.flags?crc32(state.check,output,_out,strm.next_out-_out):adler32(state.check,output,_out,strm.next_out-_out)}strm.data_type=state.bits+(state.last?64:0)+(state.mode===TYPE?128:0)+(state.mode===LEN_||state.mode===COPY_?256:0);if((_in===0&&_out===0||flush===Z_FINISH)&&ret===Z_OK){ret=Z_BUF_ERROR}return ret}function inflateEnd(strm){if(!strm||!strm.state){return Z_STREAM_ERROR}var state=strm.state;if(state.window){state.window=null}strm.state=null;return Z_OK}function inflateGetHeader(strm,head){var state;if(!strm||!strm.state){return Z_STREAM_ERROR}state=strm.state;if((state.wrap&2)===0){return Z_STREAM_ERROR}state.head=head;head.done=false;return Z_OK}function inflateSetDictionary(strm,dictionary){var dictLength=dictionary.length;var state;var dictid;var ret;if(!strm||!strm.state){return Z_STREAM_ERROR}state=strm.state;if(state.wrap!==0&&state.mode!==DICT){return Z_STREAM_ERROR}if(state.mode===DICT){dictid=1;dictid=adler32(dictid,dictionary,dictLength,0);if(dictid!==state.check){return Z_DATA_ERROR}}ret=updatewindow(strm,dictionary,dictLength,dictLength);if(ret){state.mode=MEM;return Z_MEM_ERROR}state.havedict=1;return Z_OK}exports.inflateReset=inflateReset;exports.inflateReset2=inflateReset2;exports.inflateResetKeep=inflateResetKeep;exports.inflateInit=inflateInit;exports.inflateInit2=inflateInit2;exports.inflate=inflate;exports.inflateEnd=inflateEnd;exports.inflateGetHeader=inflateGetHeader;exports.inflateSetDictionary=inflateSetDictionary;exports.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":2,"./adler32":4,"./crc32":6,"./inffast":8,"./inftrees":10}],10:[function(require,module,exports){"use strict";var utils=require("../utils/common");var MAXBITS=15;var ENOUGH_LENS=852;var ENOUGH_DISTS=592;var CODES=0;var LENS=1;var DISTS=2;var lbase=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0];
var lext=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78];var dbase=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0];var dext=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];module.exports=function inflate_table(type,lens,lens_index,codes,table,table_index,work,opts){var bits=opts.bits;var len=0;var sym=0;var min=0,max=0;var root=0;var curr=0;var drop=0;var left=0;var used=0;var huff=0;var incr;var fill;var low;var mask;var next;var base=null;var base_index=0;var end;var count=new utils.Buf16(MAXBITS+1);var offs=new utils.Buf16(MAXBITS+1);var extra=null;var extra_index=0;var here_bits,here_op,here_val;for(len=0;len<=MAXBITS;len++){count[len]=0}for(sym=0;sym<codes;sym++){count[lens[lens_index+sym]]++}root=bits;for(max=MAXBITS;max>=1;max--){if(count[max]!==0){break}}if(root>max){root=max}if(max===0){table[table_index++]=1<<24|64<<16|0;table[table_index++]=1<<24|64<<16|0;opts.bits=1;return 0}for(min=1;min<max;min++){if(count[min]!==0){break}}if(root<min){root=min}left=1;for(len=1;len<=MAXBITS;len++){left<<=1;left-=count[len];if(left<0){return-1}}if(left>0&&(type===CODES||max!==1)){return-1}offs[1]=0;for(len=1;len<MAXBITS;len++){offs[len+1]=offs[len]+count[len]}for(sym=0;sym<codes;sym++){if(lens[lens_index+sym]!==0){work[offs[lens[lens_index+sym]]++]=sym}}if(type===CODES){base=extra=work;end=19}else if(type===LENS){base=lbase;base_index-=257;extra=lext;extra_index-=257;end=256}else{base=dbase;extra=dext;end=-1}huff=0;sym=0;len=min;next=table_index;curr=root;drop=0;low=-1;used=1<<root;mask=used-1;if(type===LENS&&used>ENOUGH_LENS||type===DISTS&&used>ENOUGH_DISTS){return 1}var i=0;for(;;){i++;here_bits=len-drop;if(work[sym]<end){here_op=0;here_val=work[sym]}else if(work[sym]>end){here_op=extra[extra_index+work[sym]];here_val=base[base_index+work[sym]]}else{here_op=32+64;here_val=0}incr=1<<len-drop;fill=1<<curr;min=fill;do{fill-=incr;table[next+(huff>>drop)+fill]=here_bits<<24|here_op<<16|here_val|0}while(fill!==0);incr=1<<len-1;while(huff&incr){incr>>=1}if(incr!==0){huff&=incr-1;huff+=incr}else{huff=0}sym++;if(--count[len]===0){if(len===max){break}len=lens[lens_index+work[sym]]}if(len>root&&(huff&mask)!==low){if(drop===0){drop=root}next+=min;curr=len-drop;left=1<<curr;while(curr+drop<max){left-=count[curr+drop];if(left<=0){break}curr++;left<<=1}used+=1<<curr;if(type===LENS&&used>ENOUGH_LENS||type===DISTS&&used>ENOUGH_DISTS){return 1}low=huff&mask;table[low]=root<<24|curr<<16|next-table_index|0}}if(huff!==0){table[next+huff]=len-drop<<24|64<<16|0}opts.bits=root;return 0}},{"../utils/common":2}],11:[function(require,module,exports){"use strict";module.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],12:[function(require,module,exports){"use strict";function ZStream(){this.input=null;this.next_in=0;this.avail_in=0;this.total_in=0;this.output=null;this.next_out=0;this.avail_out=0;this.total_out=0;this.msg="";this.state=null;this.data_type=2;this.adler=0}module.exports=ZStream},{}],13:[function(require,module,exports){var bundleFn=arguments[3];var sources=arguments[4];var cache=arguments[5];var stringify=JSON.stringify;module.exports=function(fn,options){var wkey;var cacheKeys=Object.keys(cache);for(var i=0,l=cacheKeys.length;i<l;i++){var key=cacheKeys[i];var exp=cache[key].exports;if(exp===fn||exp&&exp.default===fn){wkey=key;break}}if(!wkey){wkey=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var wcache={};for(var i=0,l=cacheKeys.length;i<l;i++){var key=cacheKeys[i];wcache[key]=key}sources[wkey]=[Function(["require","module","exports"],"("+fn+")(self)"),wcache]}var skey=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var scache={};scache[wkey]=wkey;sources[skey]=[Function(["require"],"var f = require("+stringify(wkey)+");"+"(f.default ? f.default : f)(self);"),scache];var workerSources={};resolveSources(skey);function resolveSources(key){workerSources[key]=true;for(var depPath in sources[key][1]){var depKey=sources[key][1][depPath];if(!workerSources[depKey]){resolveSources(depKey)}}}var src="("+bundleFn+")({"+Object.keys(workerSources).map(function(key){return stringify(key)+":["+sources[key][0]+","+stringify(sources[key][1])+"]"}).join(",")+"},{},["+stringify(skey)+"])";var URL=window.URL||window.webkitURL||window.mozURL||window.msURL;var blob=new Blob([src],{type:"text/javascript"});if(options&&options.bare){return blob}var workerUrl=URL.createObjectURL(blob);var worker=new Worker(workerUrl);worker.objectURL=workerUrl;return worker}},{}],14:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var AbstractDecoder=function(){function AbstractDecoder(){_classCallCheck(this,AbstractDecoder)}_createClass(AbstractDecoder,[{key:"isAsync",value:function isAsync(){return typeof this.decodeBlock==="undefined"}}]);return AbstractDecoder}();exports.default=AbstractDecoder},{}],15:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _inflate=require("pako/lib/inflate");var _abstractdecoder=require("../abstractdecoder");var _abstractdecoder2=_interopRequireDefault(_abstractdecoder);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var DeflateDecoder=function(_AbstractDecoder){_inherits(DeflateDecoder,_AbstractDecoder);function DeflateDecoder(){_classCallCheck(this,DeflateDecoder);return _possibleConstructorReturn(this,(DeflateDecoder.__proto__||Object.getPrototypeOf(DeflateDecoder)).apply(this,arguments))}_createClass(DeflateDecoder,[{key:"decodeBlock",value:function decodeBlock(buffer){return Promise.resolve((0,_inflate.inflate)(new Uint8Array(buffer)).buffer)}}]);return DeflateDecoder}(_abstractdecoder2.default);exports.default=DeflateDecoder},{"../abstractdecoder":14,"pako/lib/inflate":1}],16:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getDecoder=getDecoder;var _raw=require("./raw");var _raw2=_interopRequireDefault(_raw);var _lzw=require("./lzw");var _lzw2=_interopRequireDefault(_lzw);var _deflate=require("./deflate");var _deflate2=_interopRequireDefault(_deflate);var _packbits=require("./packbits");var _packbits2=_interopRequireDefault(_packbits);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function getDecoder(compression){switch(compression){case undefined:case 1:return new _raw2.default;case 5:return new _lzw2.default;case 6:throw new Error("JPEG compression not supported.");case 8:return new _deflate2.default;case 32773:return new _packbits2.default;default:throw new Error("Unknown compression method identifier: "+this.fileDirectory.Compression)}}},{"./deflate":15,"./lzw":17,"./packbits":18,"./raw":19}],17:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _abstractdecoder=require("../abstractdecoder");var _abstractdecoder2=_interopRequireDefault(_abstractdecoder);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var MIN_BITS=9;var MAX_BITS=12;var CLEAR_CODE=256;var EOI_CODE=257;var LZW=function(){function LZW(){_classCallCheck(this,LZW);this.littleEndian=false;this.position=0;this._makeEntryLookup=false;this.dictionary=[]}_createClass(LZW,[{key:"initDictionary",value:function initDictionary(){this.dictionary=new Array(258);this.entryLookup={};this.byteLength=MIN_BITS;for(var i=0;i<=257;++i){this.dictionary[i]=[i];if(this._makeEntryLookup){this.entryLookup[i]=i}}}},{key:"decompress",value:function decompress(input){var buffer=input.buffer?input.buffer:new Uint8Array(input).buffer;this._makeEntryLookup=false;this.initDictionary();this.position=0;this.result=[];var mydataview=new DataView(buffer);var code=this.getNext(mydataview);var oldCode=void 0;while(code!==EOI_CODE){if(code===CLEAR_CODE){this.initDictionary();code=this.getNext(mydataview);while(code===CLEAR_CODE){code=this.getNext(mydataview)}if(code>CLEAR_CODE){throw new Error("corrupted code at scanline "+code)}if(code===EOI_CODE){break}else{var val=this.dictionary[code];this.appendArray(this.result,val);oldCode=code}}else if(this.dictionary[code]!==undefined){var _val=this.dictionary[code];this.appendArray(this.result,_val);var newVal=this.dictionary[oldCode].concat(this.dictionary[code][0]);this.addToDictionary(newVal);oldCode=code}else{var oldVal=this.dictionary[oldCode];if(!oldVal){throw new Error("Bogus entry. Not in dictionary, "+oldCode+" / "+this.dictionary.length+", position: "+this.position)}var _newVal=oldVal.concat(this.dictionary[oldCode][0]);this.appendArray(this.result,_newVal);this.addToDictionary(_newVal);oldCode=code}if(this.dictionary.length>=Math.pow(2,this.byteLength)-1){this.byteLength++}code=this.getNext(mydataview)}return new Uint8Array(this.result)}},{key:"appendArray",value:function appendArray(dest,source){for(var i=0;i<source.length;++i){dest.push(source[i])}return dest}},{key:"haveBytesChanged",value:function haveBytesChanged(){if(this.dictionary.length>=Math.pow(2,this.byteLength)){this.byteLength++;return true}return false}},{key:"addToDictionary",value:function addToDictionary(arr){this.dictionary.push(arr);if(this._makeEntryLookup){this.entryLookup[arr]=this.dictionary.length-1}this.haveBytesChanged();return this.dictionary.length-1}},{key:"getNext",value:function getNext(dataview){var byte=this.getByte(dataview,this.position,this.byteLength);this.position+=this.byteLength;return byte}},{key:"getByte",value:function getByte(dataview,position,length){var d=position%8;var a=Math.floor(position/8);var de=8-d;var ef=position+length-(a+1)*8;var fg=8*(a+2)-(position+length);var dg=(a+2)*8-position;fg=Math.max(0,fg);if(a>=dataview.byteLength){console.warn("ran off the end of the buffer before finding EOI_CODE (end on input code)");return EOI_CODE}var chunk1=dataview.getUint8(a,this.littleEndian)&Math.pow(2,8-d)-1;chunk1<<=length-de;var chunks=chunk1;if(a+1<dataview.byteLength){var chunk2=dataview.getUint8(a+1,this.littleEndian)>>>fg;chunk2<<=Math.max(0,length-dg);chunks+=chunk2}if(ef>8&&a+2<dataview.byteLength){var hi=(a+3)*8-(position+length);var chunk3=dataview.getUint8(a+2,this.littleEndian)>>>hi;chunks+=chunk3}return chunks}},{key:"compress",value:function compress(input){this._makeEntryLookup=true;this.initDictionary();this.position=0;var resultBits=[];var omega=[];resultBits=this.appendArray(resultBits,this.binaryFromByte(CLEAR_CODE,this.byteLength));for(var i=0;i<input.length;++i){var k=[input[i]];var omk=omega.concat(k);if(this.entryLookup[omk]!==undefined){omega=omk}else{var _code=this.entryLookup[omega];var _bin=this.binaryFromByte(_code,this.byteLength);resultBits=this.appendArray(resultBits,_bin);this.addToDictionary(omk);omega=k;if(this.dictionary.length>=Math.pow(2,MAX_BITS)){resultBits=this.appendArray(resultBits,this.binaryFromByte(CLEAR_CODE,this.byteLength));this.initDictionary()}}}var code=this.entryLookup[omega];var bin=this.binaryFromByte(code,this.byteLength);resultBits=this.appendArray(resultBits,bin);resultBits=resultBits=this.appendArray(resultBits,this.binaryFromByte(EOI_CODE,this.byteLength));this.binary=resultBits;this.result=this.binaryToUint8(resultBits);return this.result}},{key:"byteFromCode",value:function byteFromCode(code){return this.dictionary[code]}},{key:"binaryFromByte",value:function binaryFromByte(byte){var byteLength=arguments.length>1&&arguments[1]!==undefined?arguments[1]:8;var res=new Uint8Array(byteLength);for(var i=0;i<res.length;++i){var mask=Math.pow(2,i);var isOne=(byte&mask)>0;res[res.length-1-i]=isOne}return res}},{key:"binaryToNumber",value:function binaryToNumber(bin){var res=0;for(var i=0;i<bin.length;++i){res+=Math.pow(2,bin.length-i-1)*bin[i]}return res}},{key:"inputToBinary",value:function inputToBinary(input){var inputByteLength=arguments.length>1&&arguments[1]!==undefined?arguments[1]:8;var res=new Uint8Array(input.length*inputByteLength);for(var i=0;i<input.length;++i){var bin=this.binaryFromByte(input[i],inputByteLength);res.set(bin,i*inputByteLength)}return res}},{key:"binaryToUint8",value:function binaryToUint8(bin){var result=new Uint8Array(Math.ceil(bin.length/8));var index=0;for(var i=0;i<bin.length;i+=8){var val=0;for(var j=0;j<8&&i+j<bin.length;++j){val+=bin[i+j]*Math.pow(2,8-j-1)}result[index]=val;++index}return result}}]);return LZW}();var LZWDecoder=function(_AbstractDecoder){_inherits(LZWDecoder,_AbstractDecoder);function LZWDecoder(){_classCallCheck(this,LZWDecoder);return _possibleConstructorReturn(this,(LZWDecoder.__proto__||Object.getPrototypeOf(LZWDecoder)).apply(this,arguments))}_createClass(LZWDecoder,[{key:"decodeBlock",value:function decodeBlock(buffer){return Promise.resolve((new LZW).decompress(buffer).buffer)}}]);return LZWDecoder}(_abstractdecoder2.default);exports.default=LZWDecoder},{"../abstractdecoder":14}],18:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _abstractdecoder=require("../abstractdecoder");var _abstractdecoder2=_interopRequireDefault(_abstractdecoder);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var PackbitsDecoder=function(_AbstractDecoder){_inherits(PackbitsDecoder,_AbstractDecoder);function PackbitsDecoder(){_classCallCheck(this,PackbitsDecoder);return _possibleConstructorReturn(this,(PackbitsDecoder.__proto__||Object.getPrototypeOf(PackbitsDecoder)).apply(this,arguments))}_createClass(PackbitsDecoder,[{key:"decodeBlock",value:function decodeBlock(buffer){var dataView=new DataView(buffer);var out=[];for(var i=0;i<buffer.byteLength;++i){var header=dataView.getInt8(i);if(header<0){var next=dataView.getUint8(i+1);header=-header;for(var j=0;j<=header;++j){out.push(next)}i+=1}else{for(var _j=0;_j<=header;++_j){out.push(dataView.getUint8(i+_j+1))}i+=header+1}}return Promise.resolve(new Uint8Array(out).buffer)}}]);return PackbitsDecoder}(_abstractdecoder2.default);exports.default=PackbitsDecoder},{"../abstractdecoder":14}],19:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _abstractdecoder=require("../abstractdecoder");var _abstractdecoder2=_interopRequireDefault(_abstractdecoder);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var RawDecoder=function(_AbstractDecoder){_inherits(RawDecoder,_AbstractDecoder);function RawDecoder(){_classCallCheck(this,RawDecoder);return _possibleConstructorReturn(this,(RawDecoder.__proto__||Object.getPrototypeOf(RawDecoder)).apply(this,arguments))}_createClass(RawDecoder,[{key:"decodeBlock",value:function decodeBlock(buffer){return Promise.resolve(buffer)}}]);return RawDecoder}(_abstractdecoder2.default);exports.default=RawDecoder},{"../abstractdecoder":14}],20:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var DataView64=function(){function DataView64(arrayBuffer){_classCallCheck(this,DataView64);this._dataView=new DataView(arrayBuffer)}_createClass(DataView64,[{key:"getUint64",value:function getUint64(offset,littleEndian){var left=this.getUint32(offset,littleEndian);var right=this.getUint32(offset+4,littleEndian);if(littleEndian){return left<<32|right}return right<<32|left}},{key:"getInt64",value:function getInt64(offset,littleEndian){var left=void 0;var right=void 0;if(littleEndian){left=this.getInt32(offset,littleEndian);right=this.getUint32(offset+4,littleEndian);return left<<32|right}left=this.getUint32(offset,littleEndian);right=this.getInt32(offset+4,littleEndian);return right<<32|left}},{key:"getUint8",value:function getUint8(offset,littleEndian){return this._dataView.getUint8(offset,littleEndian)}},{key:"getInt8",value:function getInt8(offset,littleEndian){return this._dataView.getInt8(offset,littleEndian)}},{key:"getUint16",value:function getUint16(offset,littleEndian){return this._dataView.getUint16(offset,littleEndian)}},{key:"getInt16",value:function getInt16(offset,littleEndian){return this._dataView.getInt16(offset,littleEndian)}},{key:"getUint32",value:function getUint32(offset,littleEndian){return this._dataView.getUint32(offset,littleEndian)}},{key:"getInt32",value:function getInt32(offset,littleEndian){return this._dataView.getInt32(offset,littleEndian)}},{key:"getFloat32",value:function getFloat32(offset,littleEndian){return this._dataView.getFloat32(offset,littleEndian)}},{key:"getFloat64",value:function getFloat64(offset,littleEndian){return this._dataView.getFloat64(offset,littleEndian)}},{key:"buffer",get:function get(){return this._dataView.buffer}}]);return DataView64}();exports.default=DataView64},{}],21:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _globals=require("./globals");var _geotiffimage=require("./geotiffimage");var _geotiffimage2=_interopRequireDefault(_geotiffimage);var _dataview=require("./dataview64");var _dataview2=_interopRequireDefault(_dataview);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var GeoTIFF=function(){function GeoTIFF(rawData){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};_classCallCheck(this,GeoTIFF);this.dataView=new _dataview2.default(rawData);this.cache=options.cache||false;var BOM=this.dataView.getUint16(0,0);if(BOM===18761){this.littleEndian=true}else if(BOM===19789){this.littleEndian=false}else{throw new TypeError("Invalid byte order value.")}var magicNumber=this.dataView.getUint16(2,this.littleEndian);if(this.dataView.getUint16(2,this.littleEndian)===42){this.bigTiff=false}else if(magicNumber===43){this.bigTiff=true;var offsetBytesize=this.dataView.getUint16(4,this.littleEndian);if(offsetBytesize!==8){throw new Error("Unsupported offset byte-size.")}}else{throw new TypeError("Invalid magic number.")}this.fileDirectories=this.parseFileDirectories(this.getOffset(this.bigTiff?8:4))}_createClass(GeoTIFF,[{key:"getOffset",value:function getOffset(offset){if(this.bigTiff){return this.dataView.getUint64(offset,this.littleEndian)}return this.dataView.getUint32(offset,this.littleEndian)}},{key:"getFieldTypeLength",value:function getFieldTypeLength(fieldType){switch(fieldType){case _globals.fieldTypes.BYTE:case _globals.fieldTypes.ASCII:case _globals.fieldTypes.SBYTE:case _globals.fieldTypes.UNDEFINED:return 1;case _globals.fieldTypes.SHORT:case _globals.fieldTypes.SSHORT:return 2;case _globals.fieldTypes.LONG:case _globals.fieldTypes.SLONG:case _globals.fieldTypes.FLOAT:return 4;case _globals.fieldTypes.RATIONAL:case _globals.fieldTypes.SRATIONAL:case _globals.fieldTypes.DOUBLE:case _globals.fieldTypes.LONG8:case _globals.fieldTypes.SLONG8:case _globals.fieldTypes.IFD8:return 8;default:throw new RangeError("Invalid field type: "+fieldType)}}},{key:"getValues",value:function getValues(fieldType,count,offset){var values=null;var readMethod=null;var fieldTypeLength=this.getFieldTypeLength(fieldType);switch(fieldType){case _globals.fieldTypes.BYTE:case _globals.fieldTypes.ASCII:case _globals.fieldTypes.UNDEFINED:values=new Uint8Array(count);readMethod=this.dataView.getUint8;break;case _globals.fieldTypes.SBYTE:values=new Int8Array(count);readMethod=this.dataView.getInt8;break;case _globals.fieldTypes.SHORT:values=new Uint16Array(count);readMethod=this.dataView.getUint16;break;case _globals.fieldTypes.SSHORT:values=new Int16Array(count);readMethod=this.dataView.getInt16;break;case _globals.fieldTypes.LONG:values=new Uint32Array(count);readMethod=this.dataView.getUint32;break;case _globals.fieldTypes.SLONG:values=new Int32Array(count);readMethod=this.dataView.getInt32;break;case _globals.fieldTypes.LONG8:case _globals.fieldTypes.IFD8:values=new Array(count);readMethod=this.dataView.getUint64;break;case _globals.fieldTypes.SLONG8:values=new Array(count);readMethod=this.dataView.getInt64;break;case _globals.fieldTypes.RATIONAL:values=new Uint32Array(count*2);readMethod=this.dataView.getUint32;break;case _globals.fieldTypes.SRATIONAL:values=new Int32Array(count*2);readMethod=this.dataView.getInt32;break;case _globals.fieldTypes.FLOAT:values=new Float32Array(count);readMethod=this.dataView.getFloat32;break;case _globals.fieldTypes.DOUBLE:values=new Float64Array(count);readMethod=this.dataView.getFloat64;break;default:throw new RangeError("Invalid field type: "+fieldType)}if(!(fieldType===_globals.fieldTypes.RATIONAL||fieldType===_globals.fieldTypes.SRATIONAL)){for(var i=0;i<count;++i){values[i]=readMethod.call(this.dataView,offset+i*fieldTypeLength,this.littleEndian)}}else{for(var _i=0;_i<count;_i+=2){values[_i]=readMethod.call(this.dataView,offset+_i*fieldTypeLength,this.littleEndian);values[_i+1]=readMethod.call(this.dataView,offset+(_i*fieldTypeLength+4),this.littleEndian)}}if(fieldType===_globals.fieldTypes.ASCII){return String.fromCharCode.apply(null,values)}return values}},{key:"getFieldValues",value:function getFieldValues(fieldTag,fieldType,typeCount,valueOffset){var fieldValues=void 0;var fieldTypeLength=this.getFieldTypeLength(fieldType);if(fieldTypeLength*typeCount<=(this.bigTiff?8:4)){fieldValues=this.getValues(fieldType,typeCount,valueOffset)}else{var actualOffset=this.getOffset(valueOffset);fieldValues=this.getValues(fieldType,typeCount,actualOffset)}if(typeCount===1&&_globals.arrayFields.indexOf(fieldTag)===-1&&!(fieldType===_globals.fieldTypes.RATIONAL||fieldType===_globals.fieldTypes.SRATIONAL)){return fieldValues[0]}return fieldValues}},{key:"parseGeoKeyDirectory",value:function parseGeoKeyDirectory(fileDirectory){var rawGeoKeyDirectory=fileDirectory.GeoKeyDirectory;if(!rawGeoKeyDirectory){return null}var geoKeyDirectory={};for(var i=4;i<rawGeoKeyDirectory[3]*4;i+=4){var key=_globals.geoKeyNames[rawGeoKeyDirectory[i]];var location=rawGeoKeyDirectory[i+1]?_globals.fieldTagNames[rawGeoKeyDirectory[i+1]]:null;var count=rawGeoKeyDirectory[i+2];var offset=rawGeoKeyDirectory[i+3];var value=null;if(!location){value=offset}else{value=fileDirectory[location];if(typeof value==="undefined"||value===null){throw new Error("Could not get value of geoKey '"+key+"'.")}else if(typeof value==="string"){value=value.substring(offset,offset+count-1)}else if(value.subarray){value=value.subarray(offset,offset+count-1)}}geoKeyDirectory[key]=value}return geoKeyDirectory}},{key:"parseFileDirectories",value:function parseFileDirectories(byteOffset){var nextIFDByteOffset=byteOffset;var offsetSize=this.bigTiff?8:2;var headerSize=this.bigTiff?20:12;var fileDirectories=[];while(nextIFDByteOffset!==0){var entryCount=this.bigTiff?this.dataView.getUint64(nextIFDByteOffset,this.littleEndian):this.dataView.getUint16(nextIFDByteOffset,this.littleEndian);var fileDirectory={};var i=void 0;var c=void 0;for(i=byteOffset+offsetSize,c=0;c<entryCount;i+=headerSize,++c){var fieldTag=this.dataView.getUint16(i,this.littleEndian);var fieldType=this.dataView.getUint16(i+2,this.littleEndian);var typeCount=this.bigTiff?this.dataView.getUint64(i+4,this.littleEndian):this.dataView.getUint32(i+4,this.littleEndian);fileDirectory[_globals.fieldTagNames[fieldTag]]=this.getFieldValues(fieldTag,fieldType,typeCount,i+(this.bigTiff?12:8))}nextIFDByteOffset=this.getOffset(i);fileDirectories.push([fileDirectory,this.parseGeoKeyDirectory(fileDirectory)])}return fileDirectories}},{key:"getImage",value:function getImage(){var index=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var fileDirectoryAndGeoKey=this.fileDirectories[index];if(!fileDirectoryAndGeoKey){throw new RangeError("Invalid image index")}return new _geotiffimage2.default(fileDirectoryAndGeoKey[0],fileDirectoryAndGeoKey[1],this.dataView,this.littleEndian,this.cache)}},{key:"getImageCount",value:function getImageCount(){return this.fileDirectories.length}}]);return GeoTIFF}();exports.default=GeoTIFF},{"./dataview64":20,"./geotiffimage":22,"./globals":23}],22:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _globals=require("./globals");var _rgb=require("./rgb");var _pool=require("./pool");var _pool2=_interopRequireDefault(_pool);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{
default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function sum(array,start,end){var s=0;for(var i=start;i<end;++i){s+=array[i]}return s}function arrayForType(format,bitsPerSample,size){switch(format){case 1:switch(bitsPerSample){case 8:return new Uint8Array(size);case 16:return new Uint16Array(size);case 32:return new Uint32Array(size);default:break}break;case 2:switch(bitsPerSample){case 8:return new Int8Array(size);case 16:return new Int16Array(size);case 32:return new Int32Array(size);default:break}break;case 3:switch(bitsPerSample){case 32:return new Float32Array(size);case 64:return new Float64Array(size);default:break}break;default:break}throw Error("Unsupported data format/bitsPerSample")}var GeoTIFFImage=function(){function GeoTIFFImage(fileDirectory,geoKeys,dataView,littleEndian,cache){_classCallCheck(this,GeoTIFFImage);this.fileDirectory=fileDirectory;this.geoKeys=geoKeys;this.dataView=dataView;this.littleEndian=littleEndian;this.tiles=cache?{}:null;this.isTiled=!fileDirectory.StripOffsets;var planarConfiguration=fileDirectory.PlanarConfiguration;this.planarConfiguration=typeof planarConfiguration==="undefined"?1:planarConfiguration;if(this.planarConfiguration!==1&&this.planarConfiguration!==2){throw new Error("Invalid planar configuration.")}}_createClass(GeoTIFFImage,[{key:"getFileDirectory",value:function getFileDirectory(){return this.fileDirectory}},{key:"getGeoKeys",value:function getGeoKeys(){return this.geoKeys}},{key:"getWidth",value:function getWidth(){return this.fileDirectory.ImageWidth}},{key:"getHeight",value:function getHeight(){return this.fileDirectory.ImageLength}},{key:"getSamplesPerPixel",value:function getSamplesPerPixel(){return this.fileDirectory.SamplesPerPixel}},{key:"getTileWidth",value:function getTileWidth(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}},{key:"getTileHeight",value:function getTileHeight(){return this.isTiled?this.fileDirectory.TileLength:this.fileDirectory.RowsPerStrip}},{key:"getBytesPerPixel",value:function getBytesPerPixel(){var bitsPerSample=0;for(var i=0;i<this.fileDirectory.BitsPerSample.length;++i){var bits=this.fileDirectory.BitsPerSample[i];if(bits%8!==0){throw new Error("Sample bit-width of "+bits+" is not supported.")}else if(bits!==this.fileDirectory.BitsPerSample[0]){throw new Error("Differing size of samples in a pixel are not supported.")}bitsPerSample+=bits}return bitsPerSample/8}},{key:"getSampleByteSize",value:function getSampleByteSize(i){if(i>=this.fileDirectory.BitsPerSample.length){throw new RangeError("Sample index "+i+" is out of range.")}var bits=this.fileDirectory.BitsPerSample[i];if(bits%8!==0){throw new Error("Sample bit-width of "+bits+" is not supported.")}return bits/8}},{key:"getReaderForSample",value:function getReaderForSample(sampleIndex){var format=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[sampleIndex]:1;var bitsPerSample=this.fileDirectory.BitsPerSample[sampleIndex];switch(format){case 1:switch(bitsPerSample){case 8:return DataView.prototype.getUint8;case 16:return DataView.prototype.getUint16;case 32:return DataView.prototype.getUint32;default:break}break;case 2:switch(bitsPerSample){case 8:return DataView.prototype.getInt8;case 16:return DataView.prototype.getInt16;case 32:return DataView.prototype.getInt32;default:break}break;case 3:switch(bitsPerSample){case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64;default:break}break;default:break}throw Error("Unsupported data format/bitsPerSample")}},{key:"getArrayForSample",value:function getArrayForSample(sampleIndex,size){var format=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[sampleIndex]:1;var bitsPerSample=this.fileDirectory.BitsPerSample[sampleIndex];return arrayForType(format,bitsPerSample,size)}},{key:"getDecoder",value:function getDecoder(){return this.decoder}},{key:"getTileOrStrip",value:function getTileOrStrip(x,y,sample,pool){var numTilesPerRow=Math.ceil(this.getWidth()/this.getTileWidth());var numTilesPerCol=Math.ceil(this.getHeight()/this.getTileHeight());var index=void 0;var tiles=this.tiles;if(this.planarConfiguration===1){index=y*numTilesPerRow+x}else if(this.planarConfiguration===2){index=sample*numTilesPerRow*numTilesPerCol+y*numTilesPerRow+x}var offset=void 0;var byteCount=void 0;if(this.isTiled){offset=this.fileDirectory.TileOffsets[index];byteCount=this.fileDirectory.TileByteCounts[index]}else{offset=this.fileDirectory.StripOffsets[index];byteCount=this.fileDirectory.StripByteCounts[index]}var slice=this.dataView.buffer.slice(offset,offset+byteCount);var promise=void 0;if(tiles===null){promise=pool.decodeBlock(slice)}else if(!tiles[index]){tiles[index]=promise=pool.decodeBlock(slice)}return promise.then(function(data){return{x:x,y:y,sample:sample,data:data}})}},{key:"_readRaster",value:function _readRaster(imageWindow,samples,valueArrays,interleave,pool){var _this=this;var tileWidth=this.getTileWidth();var tileHeight=this.getTileHeight();var minXTile=Math.floor(imageWindow[0]/tileWidth);var maxXTile=Math.ceil(imageWindow[2]/tileWidth);var minYTile=Math.floor(imageWindow[1]/tileHeight);var maxYTile=Math.ceil(imageWindow[3]/tileHeight);var windowWidth=imageWindow[2]-imageWindow[0];var bytesPerPixel=this.getBytesPerPixel();var predictor=this.fileDirectory.Predictor||1;var srcSampleOffsets=[];var sampleReaders=[];for(var i=0;i<samples.length;++i){if(this.planarConfiguration===1){srcSampleOffsets.push(sum(this.fileDirectory.BitsPerSample,0,samples[i])/8)}else{srcSampleOffsets.push(0)}sampleReaders.push(this.getReaderForSample(samples[i]))}var promises=[];var littleEndian=this.littleEndian;for(var yTile=minYTile;yTile<maxYTile;++yTile){for(var xTile=minXTile;xTile<maxXTile;++xTile){var _loop=function _loop(sampleIndex){var si=sampleIndex;var sample=samples[sampleIndex];if(_this.planarConfiguration===2){bytesPerPixel=_this.getSampleByteSize(sample)}var promise=_this.getTileOrStrip(xTile,yTile,sample,pool);promises.push(promise);promise.then(function(tile){var dataView=new DataView(tile.data);var firstLine=tile.y*tileHeight;var firstCol=tile.x*tileWidth;var lastLine=(tile.y+1)*tileHeight;var lastCol=(tile.x+1)*tileWidth;var reader=sampleReaders[si];var ymax=Math.min(tileHeight,tileHeight-(lastLine-imageWindow[3]));var xmax=Math.min(tileWidth,tileWidth-(lastCol-imageWindow[2]));for(var y=Math.max(0,imageWindow[1]-firstLine);y<ymax;++y){for(var x=Math.max(0,imageWindow[0]-firstCol);x<xmax;++x){var pixelOffset=(y*tileWidth+x)*bytesPerPixel;var value=reader.call(dataView,pixelOffset+srcSampleOffsets[si],littleEndian);var windowCoordinate=void 0;if(interleave){if(predictor!==1&&x>0){windowCoordinate=(y+firstLine-imageWindow[1])*windowWidth*samples.length+(x+firstCol-imageWindow[0]-1)*samples.length+si;value+=valueArrays[windowCoordinate]}windowCoordinate=(y+firstLine-imageWindow[1])*windowWidth*samples.length+(x+firstCol-imageWindow[0])*samples.length+si;valueArrays[windowCoordinate]=value}else{if(predictor!==1&&x>0){windowCoordinate=(y+firstLine-imageWindow[1])*windowWidth+x-1+firstCol-imageWindow[0];value+=valueArrays[si][windowCoordinate]}windowCoordinate=(y+firstLine-imageWindow[1])*windowWidth+x+firstCol-imageWindow[0];valueArrays[si][windowCoordinate]=value}}}})};for(var sampleIndex=0;sampleIndex<samples.length;++sampleIndex){_loop(sampleIndex)}}}return Promise.all(promises).then(function(){return valueArrays})}},{key:"readRasters",value:function readRasters(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},wnd=_ref.window,_ref$samples=_ref.samples,samples=_ref$samples===undefined?[]:_ref$samples,interleave=_ref.interleave,_ref$poolSize=_ref.poolSize,poolSize=_ref$poolSize===undefined?null:_ref$poolSize;var imageWindow=wnd||[0,0,this.getWidth(),this.getHeight()];var pool=new _pool2.default(this.fileDirectory.Compression,poolSize);if(imageWindow[0]<0||imageWindow[1]<0||imageWindow[2]>this.getWidth()||imageWindow[3]>this.getHeight()){return Promise.reject(new Error("Select window is out of image bounds."))}else if(imageWindow[0]>imageWindow[2]||imageWindow[1]>imageWindow[3]){return Promise.reject(new Error("Invalid subsets"))}var imageWindowWidth=imageWindow[2]-imageWindow[0];var imageWindowHeight=imageWindow[3]-imageWindow[1];var numPixels=imageWindowWidth*imageWindowHeight;if(!samples){for(var i=0;i<this.fileDirectory.SamplesPerPixel;++i){samples.push(i)}}else{for(var _i=0;_i<samples.length;++_i){if(samples[_i]>=this.fileDirectory.SamplesPerPixel){return Promise.reject(new RangeError("Invalid sample index '"+samples[_i]+"'."))}}}var valueArrays=void 0;if(interleave){var format=this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1;var bitsPerSample=Math.max.apply(null,this.fileDirectory.BitsPerSample);valueArrays=arrayForType(format,bitsPerSample,numPixels*samples.length)}else{valueArrays=[];for(var _i2=0;_i2<samples.length;++_i2){valueArrays.push(this.getArrayForSample(samples[_i2],numPixels))}}return this._readRaster(imageWindow,samples,valueArrays,interleave,pool).then(function(result){pool.destroy();return result})}},{key:"readRGB",value:function readRGB(){var _ref2=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},window=_ref2.window,poolSize=_ref2.poolSize;var imageWindow=window||[0,0,this.getWidth(),this.getHeight()];if(imageWindow[0]<0||imageWindow[1]<0||imageWindow[2]>this.getWidth()||imageWindow[3]>this.getHeight()){throw new Error("Select window is out of image bounds.")}else if(imageWindow[0]>imageWindow[2]||imageWindow[1]>imageWindow[3]){throw new Error("Invalid subsets")}var width=imageWindow[2]-imageWindow[0];var height=imageWindow[3]-imageWindow[1];var pi=this.fileDirectory.PhotometricInterpretation;var bits=this.fileDirectory.BitsPerSample[0];var max=Math.pow(2,bits);if(pi===_globals.photometricInterpretations.RGB){return this.readRasters({window:window,interleave:true,poolSize:poolSize})}var samples=void 0;switch(pi){case _globals.photometricInterpretations.WhiteIsZero:case _globals.photometricInterpretations.BlackIsZero:case _globals.photometricInterpretations.Palette:samples=[0];break;case _globals.photometricInterpretations.CMYK:samples=[0,1,2,3];break;case _globals.photometricInterpretations.YCbCr:case _globals.photometricInterpretations.CIELab:samples=[0,1,2];break;default:throw new Error("Invalid or unsupported photometric interpretation.")}var subOptions={window:imageWindow,interleave:true,samples:samples,poolSize:poolSize};var fileDirectory=this.fileDirectory;return this.readRasters(subOptions).then(function(raster){switch(pi){case _globals.photometricInterpretations.WhiteIsZero:return(0,_rgb.fromWhiteIsZero)(raster,max,width,height);case _globals.photometricInterpretations.BlackIsZero:return(0,_rgb.fromBlackIsZero)(raster,max,width,height);case _globals.photometricInterpretations.Palette:return(0,_rgb.fromPalette)(raster,fileDirectory.ColorMap,width,height);case _globals.photometricInterpretations.CMYK:return(0,_rgb.fromCMYK)(raster,width,height);case _globals.photometricInterpretations.YCbCr:return(0,_rgb.fromYCbCr)(raster,width,height);case _globals.photometricInterpretations.CIELab:return(0,_rgb.fromCIELab)(raster,width,height);default:throw new Error("Unsupported photometric interpretation.")}})}},{key:"getTiePoints",value:function getTiePoints(){if(!this.fileDirectory.ModelTiepoint){return[]}var tiePoints=[];for(var i=0;i<this.fileDirectory.ModelTiepoint.length;i+=6){tiePoints.push({i:this.fileDirectory.ModelTiepoint[i],j:this.fileDirectory.ModelTiepoint[i+1],k:this.fileDirectory.ModelTiepoint[i+2],x:this.fileDirectory.ModelTiepoint[i+3],y:this.fileDirectory.ModelTiepoint[i+4],z:this.fileDirectory.ModelTiepoint[i+5]})}return tiePoints}},{key:"getGDALMetadata",value:function getGDALMetadata(){var metadata={};if(!this.fileDirectory.GDAL_METADATA){return null}var string=this.fileDirectory.GDAL_METADATA;var xmlDom=(0,_globals.parseXml)(string.substring(0,string.length-1));var result=xmlDom.evaluate("GDALMetadata/Item",xmlDom,null,XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,null);for(var i=0;i<result.snapshotLength;++i){var node=result.snapshotItem(i);metadata[node.getAttribute("name")]=node.textContent}return metadata}},{key:"getOrigin",value:function getOrigin(){var tiePoints=this.fileDirectory.ModelTiepoint;if(!tiePoints||tiePoints.length!==6){throw new Error("The image does not have an affine transformation.")}return[tiePoints[3],tiePoints[4],tiePoints[5]]}},{key:"getResolution",value:function getResolution(){if(!this.fileDirectory.ModelPixelScale){throw new Error("The image does not have an affine transformation.")}return[this.fileDirectory.ModelPixelScale[0],this.fileDirectory.ModelPixelScale[1],this.fileDirectory.ModelPixelScale[2]]}},{key:"pixelIsArea",value:function pixelIsArea(){return this.geoKeys.GTRasterTypeGeoKey===1}},{key:"getBoundingBox",value:function getBoundingBox(){var origin=this.getOrigin();var resolution=this.getResolution();var x1=origin[0];var y1=origin[1];var x2=x1+resolution[0]*this.getWidth();var y2=y1+resolution[1]*this.getHeight();return[Math.min(x1,x2),Math.min(y1,y2),Math.max(x1,x2),Math.max(y1,y2)]}}]);return GeoTIFFImage}();exports.default=GeoTIFFImage},{"./globals":23,"./pool":25,"./rgb":26}],23:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var fieldTagNames=exports.fieldTagNames={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams"};var fieldTags=exports.fieldTags={};for(var key in fieldTagNames){if(fieldTagNames.hasOwnProperty(key)){fieldTags[fieldTagNames[key]]=parseInt(key,10)}}var arrayFields=exports.arrayFields=[fieldTags.BitsPerSample,fieldTags.ExtraSamples,fieldTags.SampleFormat,fieldTags.StripByteCounts,fieldTags.StripOffsets,fieldTags.StripRowCounts,fieldTags.TileByteCounts,fieldTags.TileOffsets];var fieldTypeNames=exports.fieldTypeNames={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",16:"LONG8",17:"SLONG8",18:"IFD8"};var fieldTypes=exports.fieldTypes={};for(var _key in fieldTypeNames){if(fieldTypeNames.hasOwnProperty(_key)){fieldTypes[fieldTypeNames[_key]]=parseInt(_key,10)}}var photometricInterpretations=exports.photometricInterpretations={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,TransparencyMask:4,CMYK:5,YCbCr:6,CIELab:8,ICCLab:9};var geoKeyNames=exports.geoKeyNames={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"};var geoKeys=exports.geoKeys={};for(var _key2 in geoKeyNames){if(geoKeyNames.hasOwnProperty(_key2)){geoKeys[geoKeyNames[_key2]]=parseInt(_key2,10)}}var parseXml=exports.parseXml=void 0;if(typeof window==="undefined"){exports.parseXml=parseXml=function parseXml(xmlStr){var DOMParser=require("xmldom").DOMParser;return(new DOMParser).parseFromString(xmlStr,"text/xml")}}else if(typeof window.DOMParser!=="undefined"){exports.parseXml=parseXml=function parseXml(xmlStr){return(new window.DOMParser).parseFromString(xmlStr,"text/xml")}}else if(typeof window.ActiveXObject!=="undefined"&&new window.ActiveXObject("Microsoft.XMLDOM")){exports.parseXml=parseXml=function parseXml(xmlStr){var xmlDoc=new window.ActiveXObject("Microsoft.XMLDOM");xmlDoc.async="false";xmlDoc.loadXML(xmlStr);return xmlDoc}}},{xmldom:"xmldom"}],24:[function(require,module,exports){"use strict";var _geotiff=require("./geotiff");var _geotiff2=_interopRequireDefault(_geotiff);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function parse(data,options){var rawData=void 0;var i=void 0;var strLen=void 0;var view=void 0;if(typeof data==="string"||data instanceof String){rawData=new ArrayBuffer(data.length*2);view=new Uint16Array(rawData);for(i=0,strLen=data.length;i<strLen;++i){view[i]=data.charCodeAt(i)}}else if(data instanceof ArrayBuffer){rawData=data}else{throw new Error("Invalid input data given.")}return new _geotiff2.default(rawData,options)}if(typeof module!=="undefined"&&typeof module.exports!=="undefined"){module.exports.parse=parse}if(typeof window!=="undefined"){window.GeoTIFF={parse:parse}}},{"./geotiff":21}],25:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _webworkify=require("webworkify");var _webworkify2=_interopRequireDefault(_webworkify);var _worker=require("./worker");var _worker2=_interopRequireDefault(_worker);var _compression=require("./compression");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var defaultPoolSize=navigator.hardwareConcurrency;var Pool=function(){function Pool(compression){var size=arguments.length>1&&arguments[1]!==undefined?arguments[1]:defaultPoolSize;_classCallCheck(this,Pool);this.compression=compression;this.workers=[];this.decoder=null;for(var i=0;i<size;++i){var w=(0,_webworkify2.default)(_worker2.default);this.workers.push(w)}if(size===null||size<1){this.decoder=(0,_compression.getDecoder)(compression)}}_createClass(Pool,[{key:"decodeBlock",value:function decodeBlock(buffer){var _this=this;if(this.decoder){return this.decoder.decodeBlock(buffer)}return this.waitForWorker().then(function(currentWorker){return new Promise(function(resolve,reject){currentWorker.onmessage=function(event){_this.workers.push(currentWorker);resolve(event.data[0])};currentWorker.onerror=function(error){_this.workers.push(currentWorker);reject(error)};currentWorker.postMessage(["decode",_this.compression,buffer],[buffer])})})}},{key:"waitForWorker",value:function waitForWorker(){var _this2=this;var sleepTime=10;var waiter=function waiter(callback){if(_this2.workers.length){callback(_this2.workers.pop())}else{setTimeout(waiter,sleepTime,callback)}};return new Promise(function(resolve){waiter(resolve)})}},{key:"destroy",value:function destroy(){for(var i=0;i<this.workers.length;++i){this.workers[i].terminate()}}}]);return Pool}();exports.default=Pool},{"./compression":16,"./worker":27,webworkify:13}],26:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.fromWhiteIsZero=fromWhiteIsZero;exports.fromBlackIsZero=fromBlackIsZero;exports.fromPalette=fromPalette;exports.fromCMYK=fromCMYK;exports.fromYCbCr=fromYCbCr;exports.fromCIELab=fromCIELab;function fromWhiteIsZero(raster,max,width,height){var rgbRaster=new Uint8Array(width*height*3);var value=void 0;for(var i=0,j=0;i<raster.length;++i,j+=3){value=256-raster[i]/max*256;rgbRaster[j]=value;rgbRaster[j+1]=value;rgbRaster[j+2]=value}return rgbRaster}function fromBlackIsZero(raster,max,width,height){var rgbRaster=new Uint8Array(width*height*3);var value=void 0;for(var i=0,j=0;i<raster.length;++i,j+=3){value=raster[i]/max*256;rgbRaster[j]=value;rgbRaster[j+1]=value;rgbRaster[j+2]=value}return rgbRaster}function fromPalette(raster,colorMap,width,height){var rgbRaster=new Uint8Array(width*height*3);var greenOffset=colorMap.length/3;var blueOffset=colorMap.length/3*2;for(var i=0,j=0;i<raster.length;++i,j+=3){var mapIndex=raster[i];rgbRaster[j]=colorMap[mapIndex]/65536*256;rgbRaster[j+1]=colorMap[mapIndex+greenOffset]/65536*256;rgbRaster[j+2]=colorMap[mapIndex+blueOffset]/65536*256}return rgbRaster}function fromCMYK(cmykRaster,width,height){var rgbRaster=new Uint8Array(width*height*3);for(var i=0,j=0;i<cmykRaster.length;i+=4,j+=3){var c=cmykRaster[i];var m=cmykRaster[i+1];var y=cmykRaster[i+2];var k=cmykRaster[i+3];rgbRaster[j]=255*((255-c)/256)*((255-k)/256);rgbRaster[j+1]=255*((255-m)/256)*((255-k)/256);rgbRaster[j+2]=255*((255-y)/256)*((255-k)/256)}return rgbRaster}function fromYCbCr(yCbCrRaster,width,height){var rgbRaster=new Uint8Array(width*height*3);for(var i=0,j=0;i<yCbCrRaster.length;i+=3,j+=3){var y=yCbCrRaster[i];var cb=yCbCrRaster[i+1];var cr=yCbCrRaster[i+2];rgbRaster[j]=y+1.402*(cr-128);rgbRaster[j+1]=y-.34414*(cb-128)-.71414*(cr-128);rgbRaster[j+2]=y+1.772*(cb-128)}return rgbRaster}function fromCIELab(cieLabRaster,width,height){var T1=.008856;var T2=.206893;var MAT=[3.240479,-1.53715,-.498535,-.969256,1.875992,.041556,.055648,-.204043,1.057311];var rgbRaster=new Uint8Array(width*height*3);for(var i=0,j=0;i<cieLabRaster.length;i+=3,j+=3){var L=cieLabRaster[i];var a=cieLabRaster[i+1];var b=cieLabRaster[i+2];var fY=Math.pow((L+16)/116,3);var YT=fY>T1;fY=(YT!==0)*(L/903.3)+YT*fY;var Y=fY;fY=YT*Math.pow(fY,1/3)+(YT!==0)*(7.787*fY+16/116);var fX=a/500+fY;var XT=fX>T2;var X=XT*Math.pow(fX,3)+(XT!==0)*((fX-16/116)/7.787);var fZ=fY-b/200;var ZT=fZ>T2;var Z=ZT*Math.pow(fZ,3)+(ZT!==0)*((fZ-16/116)/7.787);X*=.950456;Z*=1.088754;rgbRaster[j]=X*MAT[0]+Y*MAT[1]+Z*MAT[2];rgbRaster[j+1]=X*MAT[3]+Y*MAT[4]+Z*MAT[5];rgbRaster[j+2]=X*MAT[6]+Y*MAT[7]+Z*MAT[8]}return rgbRaster}},{}],27:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(self){self.addEventListener("message",function(event){var _event$data=_toArray(event.data),name=_event$data[0],args=_event$data.slice(1);switch(name){case"decode":decode.apply(undefined,[self].concat(_toConsumableArray(args)));break;default:break}})};var _compression=require("./compression");function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function _toArray(arr){return Array.isArray(arr)?arr:Array.from(arr)}function decode(self,compression,buffer){var decoder=(0,_compression.getDecoder)(compression);decoder.decodeBlock(buffer).then(function(result){self.postMessage([result],[result])})}},{"./compression":16}]},{},[24]);